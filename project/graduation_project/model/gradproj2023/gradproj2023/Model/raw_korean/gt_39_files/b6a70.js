;jQuery(document).ready(function($){(function(){var post_id,suggestion_type="post",recaptcha_public_key="6Lds000UAAAAAHtg9HZ8tAFE1L_iQYiKzposMjSM";if(!$(".cnw_trigger_suggestion").length){return;}
post_id=$("#content.cnw_profile").attr('data-post-id')||$("#content.cnw_article").attr('data-post-id')||false;if(!post_id){post_id=$("#fbase_profile_container").attr("data-freebase-id")||false;if(post_id){suggestion_type="freebase";}}
function suggestFix_destroyModal(){$("#suggest_correction_modal").fadeOut(300,function(){$(this).empty().remove();});$("body").removeClass("suggest_correction_active");$(document).off('keydown.cnw_suggest_correction');$("body").off('click.cnw_suggest_correction',"#suggest_correction_modal");$("#suggest_correction_modal").off('click.cnw_suggest_correction',".scm_close_modal");$("#scm_submit_form").on('click.cnw_suggest_correction');}
function suggestFix_buildModal(form_key){var preview_url,preview_title,recaptcha_id,html=[],form_key=form_key||"correction";suggestFix_destroyModal();preview_url=window.location.href;preview_url=preview_url.split("<").join("&lt;");preview_url=preview_url.split(">").join("&gt;");preview_url=preview_url.split("#").shift();preview_title=$("h1").text()||preview_url;html.push("<div id='suggest_correction_modal'>");html.push("<div id='suggest_correction_modal_content'>");html.push("<div class='scm_header scm_leader scm_submit_remove'>Use this form to inform CNW about a possible factual or typographical issue.</div>");html.push("<div class='scm_required_message scm_submit_remove'>* Required</div>");html.push("<label for='scm_name' class='scm_row scm_row_low scm_submit_remove'>");html.push("<div class='scm_header'>Your Info <span class='scm_required_icon'>*</span></div>");html.push("<input type='text' name='scm_name' id='scm_name' class='scm_input scm_text scm_required' placeholder='Name' />");html.push("</label>");html.push("<label for='scm_email' class='scm_row scm_submit_remove'>");html.push("<input type='text' name='scm_email' id='scm_email' class='scm_input scm_text scm_required' placeholder='Email Address' />");html.push("</label>");if("empty_search"===form_key){html.push("<label for='scm_message' class='scm_row scm_submit_remove'>");html.push("<div class='scm_header'>Explain what's wrong <span class='scm_required_icon'>*</span></div>")
html.push("<textarea name='scm_message' id='scm_message' class='scm_input scm_textarea scm_required' placeholder='Describe what you were looking for'></textarea>");html.push("</label>");}else if("networth"===form_key){html.push("<label class='scm_row scm_submit_remove'>");html.push("<div class='scm_header'>What page is in question?</div>")
html.push("<a href='"+preview_url+"' target='_blank' class='scm_preview_url'>"+preview_title+"</a>");html.push("</label>");html.push("<label for='scm_networth' class='scm_row scm_submit_remove'>");html.push("<div class='scm_header'>What do you think their networth is? <span class='scm_required_icon'>*</span></div>")
html.push("<input type='text' name='scm_networth' id='scm_networth' class='scm_input scm_text scm_required' placeholder='$XX,XXX,XXX (in US Dollars)' />");html.push("</label>");html.push("<label for='scm_reason' class='scm_row scm_submit_remove'>");html.push("<div class='scm_header'>Why do you think they're worth that much? <span class='scm_required_icon'>*</span></div>")
html.push("<textarea name='scm_reason' id='scm_reason' class='scm_input scm_textarea scm_required' placeholder='I think their networth is $____ because ____'></textarea>");html.push("</label>");}else{html.push("<label class='scm_row scm_submit_remove'>");html.push("<div class='scm_header'>What page is in question?</div>")
html.push("<a href='"+preview_url+"' target='_blank' class='scm_preview_url'>"+preview_title+"</a>");html.push("</label>");html.push("<label for='scm_type' class='scm_row scm_submit_remove'>");html.push("<div class='scm_header'>What kind of error is this? <span class='scm_required_icon'>*</span></div>")
html.push("<select name='scm_type' id='scm_type' class='scm_input scm_select scm_required'>");html.push("<option value=''>Choose an option</option>");html.push("<option value='typo'>Typo</option>");html.push("<option value='fact'>Factual Error</option>");html.push("<option value='other'>Other (please describe below)</option>");html.push("</select>");html.push("</label>");html.push("<label for='scm_message' class='scm_row scm_submit_remove'>");html.push("<div class='scm_header'>Explain what's wrong <span class='scm_required_icon'>*</span></div>")
html.push("<textarea name='scm_message' id='scm_message' class='scm_input scm_textarea scm_required' placeholder='Describe the error and how you think we should change it'></textarea>");html.push("</label>");}
html.push("<label for='scm_captcha_container' class='scm_row scm_submit_remove'>");html.push("<div id='cnw_scm_recaptcha'></div>");html.push("</label>");html.push("<div class='scm_row scm_row_flat scm_submit_remove'>");html.push("<input type='submit' value='Submit Suggestion' class='scm_button scm_submit' id='scm_submit_form' /> <span class='scm_cancel_form'><a href='#' class='scm_close_modal'>Close</a></span>");html.push("</div>");html.push("<a href='#' class='scm_close_icon scm_close_modal'>Close</a>");html.push("</div>");html.push("</div>");$("body").addClass("suggest_correction_active").append(html.join(""));recaptcha_id=false;try{recaptcha_id=grecaptcha.render(document.getElementById('cnw_scm_recaptcha'),{'sitekey':recaptcha_public_key});}catch(err){}
$("#suggest_correction_modal").animate({'opacity':1},{'duration':300,'complete':function(){$(this).show();}});$(document).on('keydown.cnw_suggest_correction',function(e){if(27==e.which){suggestFix_destroyModal();}});$("body").on('click.cnw_suggest_correction',"#suggest_correction_modal",function(e){if(e.target!=this){return;}
suggestFix_destroyModal();});$("#suggest_correction_modal").on('click.cnw_suggest_correction',".scm_close_modal",function(e){e.preventDefault();suggestFix_destroyModal();});$("#scm_submit_form").on('click.cnw_suggest_correction',function(e){var scm_modal=$("#suggest_correction_modal"),scm_required_inputs=[],j,k,scm_required_input,scm_val,ajax_data;e.preventDefault();if(scm_modal.hasClass("scm_pending_ajax")){return;}
scm_modal.addClass("scm_pending_ajax");$("#suggest_correction_modal .scm_missing_field").removeClass("scm_missing_field");if("empty_search"==form_key){scm_required_inputs.push("scm_name");scm_required_inputs.push("scm_email");scm_required_inputs.push("scm_message")}else if("networth"==form_key){scm_required_inputs.push("scm_name");scm_required_inputs.push("scm_email");scm_required_inputs.push("scm_networth")
scm_required_inputs.push("scm_reason")}else{scm_required_inputs.push("scm_name");scm_required_inputs.push("scm_email");scm_required_inputs.push("scm_type");scm_required_inputs.push("scm_message");}
if(scm_required_inputs.length){for(j=0,k=scm_required_inputs.length;j<k;j+=1){scm_required_input=scm_required_inputs[j];scm_val=$("#"+scm_required_input).val()||"";if(""===scm_val){$("#suggest_correction_modal label[for='"+scm_required_input+"']").addClass("scm_missing_field");$("#"+scm_required_input).focus();scm_modal.removeClass("scm_pending_ajax");return;}}}
try{scm_recaptcha=grecaptcha.getResponse(recaptcha_id);}catch(err){}
if(!scm_recaptcha&&(typeof grecaptcha!=="undefined")){$("#suggest_correction_modal label[for='scm_captcha_container']").addClass("scm_missing_field");scm_modal.removeClass("scm_pending_ajax");return;}
ajax_data={'form':form_key,'url':window.location.href,'captcha':scm_recaptcha};if("empty_search"!==form_key){ajax_data.content_type=suggestion_type;}
if(post_id){ajax_data.post_id=post_id;}
$.each(scm_required_inputs,function(index,scm_id_key){ajax_data[scm_id_key.replace("scm_","")]=$("#"+scm_id_key).val();});$.ajax({'method':"POST",'url':"/cnw_ajax_contact.php",'data':ajax_data,'success':function(data){var html=[],data_check;data_check=data.toLowerCase();if(data_check.indexOf("successfully")>-1){$("#suggest_correction_modal").addClass("scm_submit_success");html.push("<div class='scm_row scm_message_success'>");html.push("<p>We've received your suggestion, thanks!</p>");html.push("<div class='scm_continue'><a href='#' class='scm_close_modal'>Close Form</a></div>");html.push("</div>");$("#suggest_correction_modal_content").append(html.join(""));}else{$("#suggest_correction_error").empty().html(data).addClass("scm_missing_field");}},'complete':function(){$("#suggest_correction_modal").removeClass("scm_pending_ajax");}})});}
$(".cnw_trigger_suggestion").on('click.cnw_suggest_correction',function(e){var form_key=$(this).attr('data-form-key')||"suggestion";e.preventDefault();suggestFix_buildModal(form_key);});}());});