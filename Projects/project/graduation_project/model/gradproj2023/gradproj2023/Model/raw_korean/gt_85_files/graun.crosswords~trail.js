(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{362:function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"e",function(){return c}),n.d(t,"b",function(){return m}),n.d(t,"g",function(){return u}),n.d(t,"f",function(){return l}),n.d(t,"a",function(){return d});var s=n(76),o=n(0),i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(o.a.get("switches.enableDiscussionSwitch"))return Object(s.a)({url:o.a.get("page.discussionApiUrl")+e,type:"get"===t?"jsonp":"json",method:t,crossOrigin:!0,data:n,headers:{"D2-X-UID":o.a.get("page.discussionD2Uid"),"GU-Client":o.a.get("page.discussionApiClientHeader")},withCredentials:!0});throw new Error("Discussion features have been disabled")},r=function(e,t){var n="/discussion/"+e+"/comment"+(t.replyTo?"/"+t.replyTo.commentId+"/reply":"");return i(n,"post",t)},a=function(e){return i("/comment/preview","post",e)},c=function(e){return i("/comment/"+e+"/recommend","post")},m=function(e){return i("/comment/"+e+"/highlight","post")},u=function(e){return i("/comment/"+e+"/unhighlight","post")},l=function(e,t){return i("/comment/"+e+"/reportAbuse","post",t)},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me";return i("/profile/"+e,"get")}},368:function(e,t,n){"use strict";var s=n(76),o=n(0),i=o.a.page.avatarApiUrl+"/v1",r=o.a.page.avatarImagesUrl+"/user",a=function(e,t,n){var o={url:i+t,type:"json",data:n,processData:!1,method:e,crossOrigin:!0,withCredentials:!0};return Object(s.a)(o)};t.a={request:a,getActive:function(){return a("GET","/avatars/user/me/active")},updateAvatar:function(e){return a("POST","/avatars",e)},deterministicUrl:function(e){return r+"/"+e}}},369:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var s=n(1),o=n.n(s),i=n(55),r=n.n(i),a=n(6),c=n(4),m=[],u={top:0,bottom:0},l=function e(){u.top=window.pageYOffset,u.bottom=u.top+o.a.viewport().height,0===(m=m.filter(function(e){return!e.conditionFn()||(e.loadFn(),!1)})).length&&c.a.off("window:throttledScroll",e)},d=r()(l,2e3),h=function(e,t,n){a.a.read(function(){var s=o()(e);!function(e,t){var n={conditionFn:e,loadFn:t};m.push(n),1===m.length&&c.a.on("window:throttledScroll",l),d()}(function(){var e=s.offset(),n=e.top-t,o=e.top+e.height+t;return u.top>n&&u.bottom<o},n)})}},383:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var s=n(6),o=n(4),i=n(60),r=function(){s.a.read(function(){return document.getElementsByClassName("js-id-send-validation-email")}).then(function(e){if(e.length){var t=e[0];t.addEventListener("click",function(e){e.preventDefault(),Object(i.k)()&&Object(i.m)().then(function(e){if("error"===e.status)o.a.emit("module:identity:validation-email:fail"),s.a.write(function(){t.innerHTML="An error occured, please click here to try again."});else{o.a.emit("module:identity:validation-email:success");var n=t.parentNode;if(n){var i=document.createElement("p");i.innerText="Sent. Please check your email and follow the link.",s.a.write(function(){n.replaceChild(i,t)})}}},function(){o.a.emit("module:identity:validation-email:fail"),s.a.write(function(){t.innerHTML="An error occured, please click here to try again."})})})}})}},384:function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return u});var s=n(7),o=n.n(s),i=n(368),r=n(1),a=n.n(r),c=n(0),m=n(6),u=function(e){var t=a()(a.a.create('<div class="is-updating"></div>')),n=a()(a.a.create('<img class="user-avatar__image" alt="" />')),s=e.dataset.userid,o=c.a.get("user.id",null),r=function(t,n){t.remove(),n.appendTo(e)};e.classList.remove("is-hidden"),t.css("display","block").appendTo(e),s===o?i.a.getActive().then(function(e){n.attr("src",e.data.avatarUrl)}).catch(function(){var e=i.a.deterministicUrl(s);n.attr("src",e)}).always(function(){r(t,n)}):(n.attr("src",i.a.deterministicUrl(s)),r(t,n))},l=function(){return m.a.read(function(){return document.getElementsByClassName("user-avatar")}).then(function(e){e&&[].concat(o()(e)).forEach(u)})}},395:function(e,t,n){"use strict";var s=n(14),o=n.n(s),i=n(26),r=n.n(i),a=n(84),c=n.n(a),m=n(83),u=n.n(m),l=n(17),d=n.n(l),h=n(1),p=n.n(h),g=n(33),f=n.n(g),v=n(22),b=n(34),y=n(0),C=n(23),w=n(4),k=n(219),O=n(6),j=n(19),E=n(55),S=n.n(E),T=!1,_=function(){T||(T=!0)},A=function(){T||(T=!0)},P=function(){T||w.a.on("window:throttledScroll",S()(function e(){var t,n,s;!T&&(t=Object(v.a)("#comments").offset(),n=window.pageYOffset,s=p.a.viewport().height,t.top-s/2<n&&t.top+t.height-s/3>n)&&(T||(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=y.a.get("googleAnalytics.trackers.editorial");window.ga(n+".send","event","element view","onpage item",e,Object.assign({nonInteraction:!0},t))}("scroll to comments"),T=!0),w.a.off("window:throttledScroll",S()(e,200)))},200))},D=n(354),I=n(53),L=n(362),R=n(60),M=n(384),x=n(383),H=function(e){function t(e){o()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.useBem=!0,n.templateName="comment-box",n.componentClass="d-comment-box",n.classes={},n.errors=[],n.defaultOptions={discussionId:null,apiRoot:null,maxLength:5e3,premod:!1,newCommenter:!1,hasUsername:!0,focus:!1,state:"top-level",replyTo:null,priorToVerificationDate:new Date(1392719401337)},n.errorMessages={EMPTY_COMMENT_BODY:"Please write a comment.",COMMENT_TOO_LONG:"Your comment must be fewer than 5000 characters long.",USER_BANNED:'Commenting has been disabled for this account (<a href="/community-faqs#321a">why?</a>).',IP_THROTTLED:'Commenting has been temporarily blocked for this IP address (<a href="/community-faqs">why?</a>).',DISCUSSION_CLOSED:"Sorry your comment can not be published as the discussion is now closed for comments.",PARENT_COMMENT_MODERATED:"Sorry the comment can not be published as the comment you replied to has been moderated since.",COMMENT_RATE_LIMIT_EXCEEDED:"You can only post one comment every minute. Please try again in a moment.",INVALID_PROTOCOL:"Sorry your comment can not be published as it was not sent over a secure channel. Please report us this issue using the technical issue link in the page footer.",AUTH_COOKIE_INVALID:"Sorry, your comment was not published as you are no longer signed in. Please sign in and try again.","READ-ONLY-MODE":"Sorry your comment can not currently be published as commenting is undergoing maintenance but will be back shortly. Please try again in a moment.",API_CORS_BLOCKED:"Could not post due to your internet settings, which might be\n                 controlled by your provider. Please contact your administrator\n                 or disable any proxy servers or VPNs and try again.",API_ERROR:"Sorry, there was a problem posting your comment. Please try\n                another browser or network connection.  Reference code ",EMAIL_VERIFIED:'<span class="d-comment-box__error-meta">Sent. Please check your\n                email to verify your email address. Once verified post your\n                comment.</span>',EMAIL_VERIFIED_FAIL:'We are having technical difficulties. Please try again later or\n                <a href="/send/email" class="js-id-send-validation-email">\n                <strong>resend the verification</strong></a>.',EMAIL_NOT_VALIDATED:'Please confirm your email address to comment.<br />\n                If you can\'t find the email, we can\n                <a href="_#" class="js-id-send-validation-email">\n                <strong>resend the verification email</strong></a> to your email\n                address.'},n.setOptions(e),w.a.on("module:identity:validation-email:success",function(){return n.verificationEmailSuccess()}),w.a.on("module:identity:validation-email:fail",function(){return n.verificationEmailFail()}),n}return u()(t,e),r()(t,[{key:"onboardingPreviewSuccess",value:function(e,t){var n=this.getElem("onboarding-preview-body");n&&(n.innerHTML=t.commentBody)}},{key:"getDiscussionId",value:function(){var e=this.options.discussionId,t=this.elem&&this.elem instanceof HTMLElement&&this.elem.getAttribute("data-discussion-key");return!e&&t&&(t=t.replace("discussion","")),e||t||""}},{key:"setFormState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getElem("body"),n=this.getElem("submit");n&&(e||0===t.value.length)?n.setAttribute("disabled","disabled"):n&&n.removeAttribute("disabled")}},{key:"setExpanded",value:function(){this.setState("expanded")}},{key:"getUserData",value:function(){return Object(R.h)()}},{key:"clearErrors",value:function(){var e=this.getElem("messages");e&&(e.innerHTML=""),this.errors=[],this.removeState("invalid")}},{key:"refreshUsernameHtml",value:function(){Object(R.l)();var e=this.getUserData().displayName,t=document.querySelector(".js-profile-info"),n=document.querySelector("._author_tywwu_16");t&&e&&(t.innerHTML=e),n&&e&&(n.innerHTML=e)}},{key:"previewCommentSuccess",value:function(e,t){var n=this.getElem("preview-body");n&&(n.innerHTML=t.commentBody),this.setState("preview-visible")}},{key:"fail",value:function(e){var t=void 0;try{t=JSON.parse(e.responseText)}catch(e){t={}}this.setFormState(),0===e.status?this.error("API_CORS_BLOCKED"):"EMAIL_NOT_VALIDATED"===t.errorCode?this.invalidEmailError():"IP_ADDRESS_BLOCKED"===t.errorCode?this.error("IP_THROTTLED"):this.errorMessages[t.errorCode]?this.error(t.errorCode):this.error("API_ERROR",this.errorMessages.API_ERROR+e.status)}},{key:"postCommentSuccess",value:function(e,t){this.refreshUsernameHtml(),this.options.newCommenter&&(this.options.newCommenter=!1);var n=this.getElem("body");return e.id=parseInt(t.message,10),n.value="",this.resetPreviewComment(),this.setFormState(),this.emit("post:success",e),w.a.emit("discussion:commentbox:post:success",e),e}},{key:"error",value:function(e,t){var n=this.getElem("messages");this.setState("invalid");var s='\n            <div class="d-discussion__error '+this.getClass("error",!0)+'">\n                <i class="i i-alert"></i>\n                <span class="d-discussion__error-text">\n                    '+(t||this.errorMessages[e])+"\n                </span>\n            </div>";n&&n.appendChild(p.a.create(s)[0]),this.errors.push(e)}},{key:"postComment",value:function(){var e=this,t=this.getElem("body"),n={body:(t&&t instanceof HTMLTextAreaElement&&t||{}).value};this.clearErrors();var s=function(){var t,s;return e.removeState("onboarding-visible"),n.body=(t=n.body,s=new RegExp("\\b((https?://|www.)\\S+)\\b(?![^<]*>|[^<>]*</)","g"),t.replace(s,function(e,t,n){return'<a href="'+("www."===n?"http://"+t:t)+'">'+t+"</a>"})),e.setFormState(!0),Object(L.c)(e.getDiscussionId(),n).then(function(t){return e.postCommentSuccess(n,t)}).catch(function(t){return e.fail(t)})},o=function(t){var n=e.getElem("onboarding-username");w.a.emit("user:username:updated",t.user.publicFields.username),e.options.hasUsername=!0,n&&n.classList.add("is-hidden"),s()},i=function(t){var n=e.getElem("onboarding-username-input"),s=e.getElem("onboarding-username-error-message");e.setState("onboarding-visible"),n&&n.classList.add("d-comment-box__onboarding-username-error-border"),s&&(s.innerHTML=JSON.parse(t.responseText).errors[0].description,s.classList.remove("is-hidden"))},r=function(){if(""===n.body&&e.error("EMPTY_COMMENT_BODY"),n.body.length>e.options.maxLength&&e.error("COMMENT_TOO_LONG","<b>Comments must be shorter than "+e.options.maxLength+" characters.</b>Yours is currently "+(n.body.length-e.options.maxLength)+" character(s) too long."),e.options.replyTo&&(n.replyTo=e.options.replyTo),0===e.errors.length){if(e.options.newCommenter&&!e.options.hasUsername){var t=e.getElem("onboarding-username-input");return Object(R.o)(t.value).then(o,i)}return s()}return Promise.resolve()};return this.getUserData().emailVerified?r():new Date(this.getUserData().accountCreatedDate)>this.options.priorToVerificationDate?Object(R.g)().then(function(t){if(!0===t.user.statusFields.userEmailValidated)return r();e.invalidEmailError()}):r()}},{key:"invalidEmailError",value:function(){this.removeState("onboarding-visible"),this.error("EMAIL_NOT_VALIDATED"),Object(x.a)()}},{key:"submitPostComment",value:function(e){e.preventDefault(),this.postComment()}},{key:"ready",value:function(){var e=this;if(null===this.getDiscussionId())throw new Error('CommentBox: You need to set the "data-discussion-key" on your element');var t=this.getElem("body");if(this.setFormState(),this.options.newCommenter?(d.a.on(document.body,"submit",[this.elem],function(t){return e.showOnboarding(t)}),d.a.on(document.body,"click",this.getClass("onboarding-cancel"),function(t){return e.hideOnboarding(t)})):d.a.on(document.body,"submit",[this.elem],function(t){return e.submitPostComment(t)}),d.a.on(document.body,"change keyup",[t],function(){return e.setFormState()}),d.a.on(t,"focus",function(){return e.setExpanded()}),this.on("change",".d-comment-box__body",function(){return e.resetPreviewComment()}),this.on("click",this.getClass("preview"),function(){return e.previewComment("previewCommentSuccess")}),this.on("click",this.getClass("hide-preview"),function(){return e.resetPreviewComment()}),this.on("click",this.getClass("cancel"),function(){return e.cancelComment()}),this.on("click",this.getClass("show-parent"),function(){return e.setState("parent-visible")}),this.on("click",this.getClass("hide-parent"),function(){return e.removeState("parent-visible")}),["bold","italic","quote","link"].forEach(function(t){var n=e.getClass("formatting-"+t);e.on("click",n,function(){return e.formatComment(t)})}),this.options.state&&this.setState(this.options.state),this.options.focus){var n=this.getElem("body");n&&window.setTimeout(function(){n.focus()},0)}}},{key:"hideOnboarding",value:function(e){e.preventDefault(),this.removeState("onboarding-visible")}},{key:"showOnboarding",value:function(e){if(e.preventDefault(),this.hasState("onboarding-visible")||!this.options.newCommenter)this.options.hasUsername&&this.removeState("onboarding-visible"),this.postComment();else{var t=this.getElem("onboarding-author"),n=this.getElem("onboarding-username");t&&(t.innerHTML=this.getUserData().displayName),this.setState("onboarding-visible"),this.previewComment("onboardingPreviewSuccess"),n&&this.options.hasUsername&&n.classList.add("is-hidden")}}},{key:"prerender",value:function(){var e=this;if(!this.options.premod){var t=this.getElem("premod");t&&t.parentNode&&t.parentNode.removeChild(t)}var n=this.getUserData(),s=this.getElem("author");if(s&&(s.innerHTML=n.displayName),"response"===this.options.state){var o=this.getElem("submit");o&&(o.innerHTML="Post reply")}else if(this.options.shouldRenderMainAvatar){var i=this.getElem("avatar-wrapper");i&&(i.setAttribute("userid",n.id),i.setAttribute("data-userid",n.id),Object(M.a)(i))}else{var r=document.getElementsByClassName("d-comment-box__meta")[0];r&&r.parentNode&&r.parentNode.removeChild(r)}if(this.options.replyTo){var a=this.getElem("reply-to-author"),c=this.getElem("parent-comment-body"),m=this.getElem("parent-comment-author"),u=this.options.replyTo||{},l=u.author,d=u.timestamp,h=u.body;a&&l&&(a.innerHTML=l),m&&l&&d&&(m.innerHTML=l+" @ "+d+" said:"),c&&h&&(c.innerHTML=h),window.setTimeout(function(){return t=e.getElem("parent-comment-spout"),n=!!a&&a.offsetLeft+a.getBoundingClientRect().width/2,void(t&&n&&(t.style.marginLeft=n+"px"));var t,n},0)}}},{key:"verificationEmailSuccess",value:function(){this.clearErrors(),this.error("EMAIL_VERIFIED")}},{key:"verificationEmailFail",value:function(){this.clearErrors(),this.error("EMAIL_VERIFIED_FAIL")}},{key:"previewComment",value:function(e){var t=this,n={body:this.getElem("body").value},s=this[e].bind(this);if(this.clearErrors(),""===n.body&&(this.resetPreviewComment(),this.error("EMPTY_COMMENT_BODY")),n&&n.body&&n.body.length>this.options.maxLength){var o=n.body.length-this.options.maxLength,i="\n                <b>Comments must be shorter than\n                "+this.options.maxLength+" characters</b>. Yours is currently\n                "+o+" characters too long.";this.error("COMMENT_TOO_LONG",i)}0===this.errors.length&&Object(L.d)(n).then(function(e){return s(n,e)}).catch(function(e){return t.fail(e)})}},{key:"cancelComment",value:function(){if("response"===this.options.state)this.destroy();else{var e=this.getElem("body");this.resetPreviewComment(),e.value="",this.setFormState(),this.removeState("expanded")}}},{key:"resetPreviewComment",value:function(){var e=this.getElem("preview-body");this.removeState("preview-visible"),e&&(e.innerHTML="")}},{key:"formatComment",value:function(e){var t=this.getElem("body"),n=t.selectionStart,s=t.value.substring(t.selectionStart,t.selectionEnd),o=function(e,o){var i=e+s+o;t.value=t.value.substring(0,t.selectionStart)+i+t.value.substring(t.selectionEnd),function(e){t.setSelectionRange(n,n+e.length)}(i)};switch(e){case"bold":o("<b>","</b>");break;case"italic":o("<i>","</i>");break;case"quote":o("<blockquote>","</blockquote>");break;case"link":!function(){var e=void 0,n=void 0;/^https?:\/\//i.test(s)?e=s:(e=n=window.prompt("Your URL:","http://www."),s=s||n);var o='<a href="'+e+'">'+s+"</a>";t.value=t.value.substring(0,t.selectionStart)+o+t.value.substring(t.selectionEnd)}()}}}]),t}(I.a),N=n(56),U=n.n(N),F=n(29),B=n(54),z=n(382),q=n.n(z),Y=function(){function e(t){o()(this,e),this.discussionId=t.discussionId,this.discussion=[],this.params={orderBy:t.orderBy,displayThreaded:t.displayThreaded,maxResponses:t.maxResponses,commentsClosed:t.commentsClosed}}return r()(e,[{key:"firstPageLoaded",value:function(e){if(this.storeCommentPage(e,1),this.discussionContainer=p.a.create(e.commentsHtml),this.postedCommentHtml=e.postedCommentHtml,this.lastPage=e.lastPage,this.commentsThread=Object(v.a)(".d-thread--comments",this.discussionContainer).empty(),e.commentCount>1e3)throw new Error("Discussion comment count too large");return q()(2,this.lastPage+1)}},{key:"storeCommentPage",value:function(e,t){var n=Object(v.a)(".d-thread--comments",p.a.create(e.commentsHtml)),s=Object(v.a)(".d-comment--top-level",n);"newest"===this.params.orderBy&&(s=s.map(function(e){return e}).reverse()),this.discussion[t]=s}},{key:"loadPage",value:function(e){var t={orderBy:"oldest",page:e,pageSize:50,displayThreaded:this.params.displayThreaded,commentsClosed:this.params.commentsClosed};this.params.maxResponses&&(t.maxResponses=this.params.maxResponses);var n="/discussion/"+this.discussionId+".json?"+Object(B.b)(t);return Object(j.a)(n,{mode:"cors"})}},{key:"loadPageAndStore",value:function(e){var t=this;return this.loadPage(e).then(function(n){t.storeCommentPage(n,e)})}},{key:"loadRemainingPages",value:function(e){return t=this.loadPageAndStore.bind(this),n=e,new Promise(function(e){var s=n,o=0,i=function(){o-=1,s.length?r(s.shift()):o||e()},r=function(e){o+=1,t.call(null,e).then(i,i)};n&&n.length?n.splice(0,3).forEach(r):e()});var t,n}},{key:"makeDiscussionResponseObject",value:function(){return"newest"===this.params.orderBy&&this.discussion.reverse(),this.discussion.reduce(function(e,t){return e.append(t),e},this.commentsThread),{paginationHtml:"",postedCommentHtml:this.postedCommentHtml,commentsHtml:this.discussionContainer.html(),lastPage:this.lastPage}}},{key:"loadAllComments",value:function(){var e=this;return this.loadPage(1).then(function(t){return e.firstPageLoaded(t)}).then(function(t){return e.loadRemainingPages(t)}).then(function(){return e.makeDiscussionResponseObject()})}}]),e}(),V=n(351),J=n(85),G=n(211),K=function(){return null===J.a.get("discussion.enableRelativeTimestamps")||J.a.get("discussion.enableRelativeTimestamps")},$=function(e){function t(e){o()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.componentClass="d-comments",n.comments=null,n.topLevelComments=null,n.user=null,n.classes={comments:"d-thread--top-level",topLevelComment:"d-comment--top-level",reply:"d-comment--response",showReplies:"d-show-more-replies",showRepliesButton:"d-show-more-replies__button",newComments:"js-new-comments",comment:"d-comment",commentReply:"d-comment__action--reply",commentPick:"d-comment__action--pick",commentStaff:"d-comment--staff",commentBody:"d-comment__body",commentTimestampJs:"js-timestamp",commentReport:"js-report-comment"},n.defaultOptions={discussionId:null,showRepliesCount:3,commentId:null,order:"newest",threading:"collapsed"},n.setOptions(e),n}return u()(t,e),r()(t,[{key:"getMoreReplies",value:function(e){var t=this;e.preventDefault();var n=e.target,s=e.currentTarget,o=s.closest(this.getClass("showReplies"));o&&(o.innerHTML="Loading…");var i=p()(n).data("source-comment"),r=s.getAttribute("data-comment-id");if(r){var a="/discussion/comment/"+r+".json?displayThreaded=true";Object(j.a)(a,{mode:"cors"}).then(function(e){var n=p.a.create(e.html),s=f()(t.getClass("reply"),n).slice(t.options&&t.options.showRepliesCount);p()(f()(".d-thread--responses",i)).append(s),p()(o).addClass("u-h"),t.emit("untruncate-thread"),K()&&t.relativeDates()}).catch(function(e){Object(F.a)(e,{feature:"comments-more-replies"})})}}},{key:"addMoreRepliesButtons",value:function(e){var t=this;(e||this.topLevelComments).forEach(function(e){var n=parseInt(e.getAttribute("data-comment-replies"),10),s=f()(t.getClass("reply"),e);if(s.length<n){var o=n-s.length,i='\n                    <button class="u-button-reset button button--show-more button--small button--tone-news d-show-more-replies__button">\n                        '+Object(G.a)("plus",["icon"])+"Show "+o+" more "+(1===o?"reply":"replies")+"\n                    </button>",r=v.a.create(i).attr({"data-link-name":"Show more replies","data-is-ajax":"","data-comment-id":e.getAttribute("data-comment-id")}).data("source-comment",e);v.a.create('<li class="'+t.getClass("showReplies",!0)+'"></li>').append(r).appendTo(Object(v.a)(".d-thread--responses",e))}})}},{key:"fetchComments",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(this.options||{}).discussionId,s="/discussion/"+(t.comment?"comment-context/"+t.comment:n)+".json",o=t.order||this.options&&this.options.order,i=void 0,r={mode:"cors"};"recommendations"===o&&(o="mostRecommended");var a={orderBy:o,pageSize:t.pagesize||this.options&&this.options.pagesize,displayThreaded:!(!this.options||"unthreaded"===this.options.threading),commentsClosed:t.commentsClosed};return t.page&&(a.page=t.page),!t.comment&&this.options&&"collapsed"===this.options.threading&&(a.maxResponses=3),this.isAllPageSizeActive()?i=new Y({discussionId:this.options&&this.options.discussionId,orderBy:a.orderBy,displayThreaded:a.displayThreaded,maxResponses:a.maxResponses,commentsClosed:a.commentsClosed}).loadAllComments().catch(function(){return e.wholeDiscussionErrors=!0,a.pageSize=100,Object(j.a)(s+"?"+Object(B.b)(a),r)}):("All"===a.pageSize&&(a.pageSize=100),i=Object(j.a)(s+"?"+Object(B.b)(a),r)),i.then(function(t){return e.renderComments(t)})}},{key:"handlePickClick",value:function(e){e.preventDefault();var t=e.target,n=t.getAttribute("data-comment-id"),s=Object(v.a)(t),o="true"===s[0].getAttribute("data-comment-highlighted")?this.unPickComment:this.pickComment;n&&o.call(this,n,s).catch(function(e){var t=e.response.length>0?JSON.parse(e.response).message:e.statusText;s.text(t)})}},{key:"pickComment",value:function(e,t){var n=this,s=f()("#comment-"+e,this.elem);return Object(L.b)(e).then(function(){Object(v.a)(n.getClass("commentPick"),s).removeClass("u-h"),t.text("Unpick"),s.setAttribute("data-comment-highlighted",!0)})}},{key:"ready",value:function(){var e=this;this.topLevelComments=f()(this.getClass("topLevelComment"),this.elem),this.comments=f()(this.getClass("comment"),this.elem),this.on("click",this.getClass("showRepliesButton"),function(t){return e.getMoreReplies(t)}),this.on("click",this.getClass("commentReport"),function(t){return e.reportComment(t)}),K()&&(window.setInterval(function(){return e.relativeDates()},6e4),this.relativeDates()),this.emit("ready"),this.on("click",".js-report-comment-close",function(){var e=document.querySelector(".js-report-comment-form");e&&e.setAttribute("hidden","")})}},{key:"showHiddenComments",value:function(e){e&&e.preventDefault(),this.emit("first-load"),Object(v.a)(".js-discussion-main-comments").css("display","block"),K()&&this.relativeDates()}},{key:"unPickComment",value:function(e,t){var n=this,s=f()("#comment-"+e);return Object(L.g)(e).then(function(){Object(v.a)(n.getClass("commentPick"),s).addClass("u-h"),t.text("Pick"),s.setAttribute("data-comment-highlighted",!1)})}},{key:"isReadOnly",value:function(){return!!(this.elem&&this.elem instanceof HTMLElement&&"true"===this.elem.getAttribute("data-read-only"))}},{key:"addComment",value:function(e,t){var n=p.a.create(this.postedCommentEl)[0],s=p()(n),o=n&&n.getElementsByClassName(this.getClass("commentReply",!0))[0],i={username:"d-comment__author",timestamp:"js-timestamp",body:"d-comment__body",report:"d-comment__action--report",avatar:"d-comment__avatar"},r={username:this.user&&this.user.displayName,timestamp:"Just now",body:"<p>"+e.body.replace(/\n+/g,"</p><p>")+"</p>",report:{href:"http://discussion.theguardian.com/components/report-abuse/"+e.id},avatar:{src:this.user&&this.user.avatar}};s.addClass("d-comment--new"),Object.keys(i).forEach(function(e){var t=i[e],s=r[e],o=f()("."+t,n)[0];"string"==typeof s?o.innerHTML=s:"object"===(void 0===s?"undefined":U()(s))&&Object.keys(s).forEach(function(e){o.setAttribute(e,s[e])})}),n.id="comment-"+e.id,this.user&&!this.user.isStaff&&s.addClass(this.getClass("commentStaff",!0)),o&&o.setAttribute("data-comment-id",e.id),t?(s.removeClass(this.getClass("topLevelComment",!0)),s.addClass(this.getClass("reply",!0)),p()(t).append(s)):Object(v.a)(this.getClass("newComments"),this.elem).prepend(n),window.location.replace("#comment-"+e.id)}},{key:"replyToComment",value:function(e){var t=this;e.preventDefault();var n=e.currentTarget.getAttribute("data-comment-id");if(n){var s=document.getElementById("reply-to-"+n);if(s)s.focus();else{Object(v.a)(".d-comment-box--response").remove();var o=f()("#comment-"+n)[0],i=o.getAttribute("data-comment-author"),r=o.getAttribute("data-comment-author-id"),a=p()(o),c=f()(this.getClass("commentBody"),o)[0].innerHTML,m=f()(this.getClass("commentTimestampJs"),o)[0].innerHTML,u=new H({discussionId:this.options&&this.options.discussionId,premod:this.user&&this.user.privateFields&&this.user.privateFields.isPremoderated,state:"response",replyTo:{commentId:n,author:i,authorId:r,body:c,timestamp:m},focus:!0}),l=a.hasClass(this.getClass("topLevelComment",!0))?a[0]:a.parent().parent()[0],d=f()(this.getClass("showReplies"),l);d.length>0&&!p()(d).hasClass("u-h")&&d[0].click(),u.render(l),u.on("post:success",function(e){var n=f()(".d-thread--responses",l)[0];n||(n=p.a.create('<ul class="d-thread d-thread--responses"></ul>')[0],p()(l).append(n)),u.destroy(),t.addComment(e,n)})}}}},{key:"reportComment",value:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-comment-id");if(t){var n=document.querySelector("#comment-"+t+" .js-report-comment-container");Object(v.a)(".js-report-comment-form").first().each(function(e){e.removeAttribute("hidden"),d.a.one(e,"submit",function(n){n.preventDefault();var s=e.querySelector('[name="category"]'),o=e.querySelector('[name="comment"]');if(t&&"0"!==s.value){var i=e.querySelector('[name="email"]');Object(L.f)(t,{emailAddress:i.value,categoryId:s.value,reason:o.value}).then(function(){e.setAttribute("hidden","")}).catch(function(){return e=document.querySelector(".d-report-comment__close"),(t=document.querySelector(".js-discussion__report-comment-error"))&&t.removeAttribute("hidden"),void(e&&e.classList.add("d-report-comment__close--error"));var e,t})}})}).appendTo(n)}}},{key:"addUser",value:function(e){var t=this;this.user=e,this.user&&this.user.badge&&(this.user.isStaff=this.user.badge.some(function(e){return"Staff"===e.name})),this.isReadOnly()||this.user&&this.user.privateFields.canPostComment&&(Object(v.a)(this.getClass("commentReply")).attr("href","#"),this.on("click",this.getClass("commentReply"),function(e){return t.replyToComment(e)}),this.on("click",this.getClass("commentPick"),function(e){return t.handlePickClick(e)})),w.a.on("user:username:updated",function(e){t.user&&(t.user.displayName=e)})}},{key:"relativeDates",value:function(){K()&&Object(V.a)()}},{key:"isAllPageSizeActive",value:function(){return!(!y.a.get("switches.discussionAllPageSize")||!this.options||"All"!==this.options.pagesize||this.wholeDiscussionErrors)}},{key:"shouldShowPageSizeMessage",value:function(){return!!(y.a.get("switches.discussionAllPageSize")&&this.options&&"All"===this.options.pagesize&&this.wholeDiscussionErrors)}},{key:"renderComments",value:function(e){var t=p.a.create(e.commentsHtml),n=f()(this.getClass("comment"),t);p()(this.elem).empty().append(t),this.addMoreRepliesButtons(n),this.postedCommentEl=e.postedCommentHtml,K()&&this.relativeDates(),this.emit("rendered",e.paginationHtml),w.a.emit("modules:comments:renderComments:rendered")}}]),t}(I.a),W=n(7),X=n.n(W),Q=n(9),Z=n.n(Q),ee=n(386),te=n(209),ne=function(e,t,n){if(!y.a.switches.discussionAllowAnonymousRecommendsSwitch&&!n)return e.setAttribute("data-link-name","Recommend comment anonymous"),function(e){var t=document.querySelector(".js-rec-tooltip");if(!t)return Promise.resolve();var n=t.querySelectorAll(".js-rec-tooltip-link");return O.a.write(function(){!function(e,t){for(var n=0,s=e.length;n<s;n+=1){var o=e[n].getAttribute("href");if(o){var i=o.split("?")[0],r=Object(B.d)(o.split("?")[1]||"&");e[n].setAttribute("href",i+"?"+Object(B.b)(Object.assign({},r,{returnUrl:t})))}}}(n,e.getAttribute("data-comment-url")),t.removeAttribute("hidden"),e.appendChild(t)})}(e);if((y.a.switches.discussionAllowAnonymousRecommendsSwitch||n)&&(o=t)&&o.querySelector(".d-discussion--recommendations-open")){var s=e.getAttribute("data-comment-id");return s?Promise.all([function(e){return O.a.write(function(){e.classList.remove("js-recommend-comment"),e.classList.add("d-comment__recommend--clicked")})}(e),Object(L.e)(s)]).then(function(){return function(e){return O.a.write(function(){e.classList.add("d-comment__recommend--recommended")})}(e)}).catch(function(t){return function(e){return O.a.write(function(){e.classList.add("js-recommend-comment"),e.classList.remove("d-comment__recommend--clicked")})}(e).then(function(){Object(F.a)(t,{feature:"comments-recommend"})})}):Promise.resolve()}var o;return Promise.resolve()};n.d(t,"a",function(){return se});var se=function(e){function t(){o()(this,t);var e=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.classes={},e.componentClass="discussion",e.comments=null,e.user=null,e.username=null,Object(D.a)("discussion"),e}return u()(t,e),r()(t,[{key:"getUser",value:function(){var e=this;Object(R.h)()?Object(L.a)().then(function(t){e.user=t.userProfile,Object(R.f)(function(t){t&&t.publicFields.username&&(e.username=t.publicFields.username),e.emit("user:loaded")})}):this.emit("user:loaded")}},{key:"getDiscussionId",value:function(){if(this.elem&&this.elem instanceof HTMLElement)return this.elem.getAttribute("data-discussion-key")}},{key:"getDiscussionClosed",value:function(){return!!(this.elem&&this.elem instanceof HTMLElement&&"true"===this.elem.getAttribute("data-discussion-closed"))}},{key:"getCommentIdFromHash",value:function(){var e=/#comment-(\d+)/.exec(window.location.hash);return e?parseInt(e[1],10):null}},{key:"setCommentHash",value:function(e){window.location.replace("#comment-"+e)}},{key:"commentPosted",value:function(e){this.removeState("truncated"),this.comments&&this.comments.addComment(e)}},{key:"initState",value:function(){this.getDiscussionClosed()?this.setState("closed"):this.comments&&this.comments.isReadOnly()?this.setState("readonly"):Object(R.h)()&&this.user&&this.user.privateFields&&!this.user.privateFields.canPostComment?this.setState("banned"):this.setState("open")}},{key:"isCommentable",value:function(){var e=this.user&&this.user.privateFields&&this.user.privateFields.canPostComment,t=this.comments&&!this.comments.isReadOnly();return!(!e||!t||this.getDiscussionClosed())}},{key:"ready",value:function(){var e=this;this.$topCommentsContainer=Object(v.a)(".js-discussion-top-comments"),this.initTopComments(),this.initMainComments(),this.initToolbar(),this.renderCommentCount(),this.initPagination(),this.initRecommend(),w.a.on("discussion:seen:comment-permalink",A),w.a.on("discussion:seen:comments-anchor",_),P(),"#comments"===window.location.hash?w.a.emit("discussion:seen:comments-anchor"):this.getCommentIdFromHash()&&w.a.emit("discussion:seen:comment-permalink"),w.a.on("discussion:commentbox:post:success",function(){return e.removeState("empty")}),w.a.on("module:clickstream:click",function(t){t&&"hash"in t.target&&"#comments"===t.target.hash&&e.removeTruncation()}),Object(D.b)("discussion")}},{key:"initRecommend",value:function(){var e=this;this.on("click",".js-recommend-comment",function(t){var n=t.currentTarget;e.user&&e.elem instanceof HTMLElement&&ne(n,e.elem,e.user)}),this.on("click",".js-rec-tooltip-close",function(){O.a.write(function(){var e=document.querySelector(".js-rec-tooltip");e&&e.setAttribute("hidden","")})})}},{key:"initToolbar",value:function(){var e=this,t=Object(v.a)(".js-comment-order"),n=Object(v.a)(".js-comment-threading");if(n.text(this.comments&&this.comments.options.threading),t.text(this.comments&&this.comments.options.order),this.on("click",".js-comment-order-dropdown .popup__action",function(n){d.a.fire(f()(".js-comment-order-dropdown [data-toggle]")[0],"click"),e.comments&&(e.comments.options.order=p()(n.currentTarget).data("order")),t.text(e.comments&&e.comments.options.order),J.a.set("discussion.order",e.comments&&e.comments.options.order),e.loadComments({page:1})}),this.on("click",".js-comment-threading-dropdown .popup__action",function(t){d.a.fire(f()(".js-comment-threading-dropdown [data-toggle]")[0],"click"),e.comments&&(e.comments.options.threading=p()(t.currentTarget).data("threading")),n.text(e.comments&&e.comments.options.threading),J.a.set("discussion.threading",e.comments&&e.comments.options.threading),e.loadComments()}),"crosswords"===y.a.get("page.section")){var s=Object(v.a)(".js-timestamps"),o=function(e){s.text(e?"Relative":"Absolute")};o();var i=null===J.a.get("discussion.enableRelativeTimestamps")||J.a.get("discussion.enableRelativeTimestamps");o(i),this.on("click",".js-timestamps-dropdown .popup__action",function(t){var n=p()(t.currentTarget).data("timestamp");d.a.fire(f()(".js-timestamps-dropdown [data-toggle]")[0],"click"),o("relative"===n),J.a.set("discussion.enableRelativeTimestamps","relative"===n),e.loadComments()})}}},{key:"initPageSizeDropdown",value:function(e){var t=this,n=Object(v.a)(".js-comment-pagesize");n.text(e),this.on("click",".js-comment-pagesize-dropdown .popup__action",function(e){var s=p()(e.currentTarget).data("pagesize");d.a.fire(f()(".js-comment-pagesize-dropdown [data-toggle]")[0],"click"),t.comments&&(t.comments.options.pagesize=s),n.text(s),J.a.set("discussion.pagesize",s),t.loadComments({page:1})})}},{key:"initMainComments",value:function(){var e=this,t=this.getCommentIdFromHash(),n=J.a.get("discussion.order")||(this.getDiscussionClosed()?"oldest":"newest"),s=J.a.get("discussion.threading")||"collapsed",o=Object(C.l)({min:"tablet"})?25:10;this.comments=new $({discussionId:this.getDiscussionId(),order:n,pagesize:o,threading:s}),this.comments&&this.comments.attachTo(f()(".js-discussion-main-comments")[0]),this.comments&&this.comments.on("untruncate-thread",function(){return e.removeTruncation()}),this.on("click,",".js-discussion-author-link",function(){return e.removeTruncation()}),this.on("click",".js-discussion-change-page, .js-discussion-show-button",function(){w.a.emit("discussion:comments:get-more-replies"),e.removeTruncation()}),this.comments&&this.comments.on("rendered",function(t){var n=p.a.create(t),s=f()(".js-discussion-toolbar",e.elem)[0],o=Object(v.a)(".js-discussion-pagination",s).empty();e.comments&&!e.comments.isAllPageSizeActive()&&o.html(n)}),this.setState("loading"),this.on("user:loaded",function(){if(e.initState(),e.renderCommentBar(),e.user){e.comments&&e.comments.addUser(e.user);var n=J.a.get("discussion.pagesize"),s=o;"number"==typeof n?s=n:"All"===n&&(s=y.a.get("switches.discussionAllPageSize")?"All":100),e.initPageSizeDropdown(s),e.comments&&y.a.get("switches.discussionPageSize")&&Object(C.l)({min:"tablet"})&&(e.comments.options.pagesize=s),e.user&&e.user.isStaff&&(e.removeState("not-staff"),e.setState("is-staff"))}var i=!t&&"#comments"!==window.location.hash;e.loadComments({comment:t,shouldTruncate:i}).catch(function(){return e.logError("Comments")})}),this.getUser()}},{key:"initTopComments",value:function(){var e=this,t=this.getDiscussionId();return this.on("click",".js-jump-to-comment",function(t){t.preventDefault();var n=p()(t.currentTarget).data("comment-id");e.gotoComment(n)}),t?Object(j.a)("/discussion/top-comments/"+t+".json?commentsClosed="+this.getDiscussionClosed().toString(),{mode:"cors"}).then(function(t){e.$topCommentsContainer.html(t.html),e.topCommentCount=f()(".d-top-comment",e.$topCommentsContainer[0]).length,0!==e.topCommentCount&&(Object(v.a)(".js-discussion-comment-box--bottom").removeClass("discussion__comment-box--bottom--hidden"),e.setState("has-top-comments"))}).catch(function(){return e.logError("Top comments")}):Promise.resolve()}},{key:"logError",value:function(e,t){var n=e+" failed to load: ";t&&t.message&&(n+=t.message),b.a.captureMessage(n,{tags:{contentType:"comments",discussionId:this.getDiscussionId()}})}},{key:"initPagination",value:function(){var e=this;this.on("click",".js-discussion-change-page",function(t){var n=t.currentTarget,s=parseInt(n.getAttribute("data-page"),10);t.preventDefault(),e.setState("loading"),e.gotoPage(s)})}},{key:"gotoComment",value:function(e,t){var n=this;Object(v.a)("#comment-"+e,this.elem).length>0?"none"===Object(v.a)(".js-discussion-main-comments").css("display")?O.a.write(function(){n.comments&&n.comments.showHiddenComments(),n.removeState("truncated"),Object(v.a)(".d-discussion__show-all-comments").addClass("u-h")}).then(function(){n.setCommentHash(e)}):this.setCommentHash(e):t?(Object(k.b)(f()(".js-discussion-toolbar"),100),O.a.write(function(){Object(v.a)(".js-discussion-main-comments").prepend('<div class="d-discussion__message d-discussion__message--error">The comment you requested could not be found.</div>')}),b.a.captureMessage("Comment doesn't exist in response",{level:"error",extra:{commentId:e}})):this.loadComments({comment:e})}},{key:"gotoPage",value:function(e){Object(k.b)(f()(".js-discussion-toolbar"),100),this.comments&&this.comments.relativeDates(),this.loadComments({page:e})}},{key:"loadComments",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},t);return this.setState("loading"),n.shouldTruncate&&this.comments&&this.comments.isAllPageSizeActive()&&(n.pageSize=10),n.commentsClosed=this.getDiscussionClosed(),this.comments?this.comments.fetchComments(n).then(function(){e.removeState("loading"),n.shouldTruncate?e.setState("truncated"):e.removeState("truncated"),e.comments&&e.comments.shouldShowPageSizeMessage()?e.setState("pagesize-msg-show"):e.removeState("pagesize-msg-show"),n.comment&&e.gotoComment(n.comment.toString(),!0)}):Promise.resolve()}},{key:"removeTruncation",value:function(){this.comments&&this.comments.isAllPageSizeActive()?this.loadComments():this.removeState("truncated")}},{key:"renderCommentBox",value:function(e){var t=this;new H({discussionId:this.getDiscussionId(),premod:this.user&&this.user.privateFields&&this.user.privateFields.isPremoderated,newCommenter:this.user&&this.user.privateFields&&!this.user.privateFields.hasCommented,hasUsername:null!==this.username,shouldRenderMainAvatar:!1}).render(e).on("post:success",function(e){return t.commentPosted(e)})}},{key:"renderCommentBar",value:function(){this.isCommentable()&&(this.renderCommentBox(f()(".js-discussion-comment-box--top")[0]),this.renderCommentBox(f()(".js-discussion-comment-box--bottom")[0]))}},{key:"renderCommentCount",value:function(){var e,t,n,s;e=this,t={apiHost:y.a.page.discussionApiUrl,avatarImagesHost:y.a.page.avatarImagesUrl,closed:this.getDiscussionClosed(),discussionId:this.getDiscussionId(),element:document.getElementsByClassName("js-discussion-external-frontend")[0],userFromCookie:!!Object(R.h)(),profileUrl:y.a.page.idUrl,profileClientId:y.a.switches.registerWithPhone?"comments":"",Promise:Promise},n=function(t){t.on("error",function(e,t){Object(F.a)(t,{feature:"discussion-"+e},!1)}),t.once("comment-count",function(t){if(0===t)e.setState("empty");else{var n=document.getElementsByClassName("js_commentcount_actualvalue");[].concat(X()(n)).forEach(function(e){!function(e,t){var n=Object(ee.a)(t);n&&Z.a.write(function(){e.textContent=n})}(e,t)})}w.a.emit("comments-count-loaded")})},s=function(e){Object(F.a)(e,{feature:"discussion"})},Object(te.a)(y.a.get("page.discussionFrontendUrl")).then(function(){(0,window.guardian.app.discussion)(t).then(n).catch(s)}).catch(s)}}]),t}(I.a)},413:function(e,t,n){"use strict";n.d(t,"a",function(){return b});var s=n(14),o=n.n(s),i=n(26),r=n.n(i),a=n(84),c=n.n(a),m=n(83),u=n.n(m),l=n(7),d=n.n(l),h=n(0),p=n(4),g=n(354),f=function(){return[].concat(d()(h.a.get("page.nonKeywordTagIds","").split(",")),d()(h.a.get("page.blogIds","").split(",")),[h.a.get("page.seriesId")]).shift()},v=function(){return encodeURIComponent(h.a.get("page.shortUrl"))},b=function(e){function t(e){o()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object(g.a)("series-content"),n.endpoint="/series/"+f()+".json?shortUrl="+v(),n.fetch(e,"html"),n}return u()(t,e),r()(t,[{key:"error",value:function(){Object(g.c)("series-content")}},{key:"ready",value:function(){Object(g.b)("series-content"),p.a.emit("modules:onward:loaded")}}]),t}(n(53).a)}}]);
//# sourceMappingURL=graun.crosswords~trail.js.map