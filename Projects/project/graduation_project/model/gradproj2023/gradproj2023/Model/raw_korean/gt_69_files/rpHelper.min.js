/* rpHelper.js v0.6.6 */var RPEventConstants={END_CARD_REPLAY_CLIP_EVENT:"endCardReplayClipEvent",END_CARD_COUNTDOWN_TIMER_COMPLETE_EVENT:"endCardCountdownTimerCompleteEvent",END_CARD_PLAY_NEXT_ITEM_EVENT:"endCardPlayNextItemEvent"};"undefined"!=typeof module&&null!=module.exports&&(exports.RPEventConstants=RPEventConstants),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("'this' is null or not defined");var r=Object(this),a=r.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=arguments[1],n=0;n<a;){var o=r[n];if(e.call(t,o,n,r))return o;n++}},configurable:!0,writable:!0});var RPHelperEvents={handlerFunction:void 0,allowedOrigins:["player.theplatform.com","tverationalplayer-stage.akamaized.net","tverationalplayer.akamaized.net","nbc.com","nbcuni.com"],handleEvent:function(e){RPHelperEvents.canHandleEvent(e)&&void 0!==RPHelperEvents.handlerFunction&&"function"==typeof RPHelperEvents.handlerFunction&&RPHelperEvents.handlerFunction(e)},canHandleEvent:function(e){return this.isAllowedOrigins(e.origin)&&this.isAllowedEventType(e.data.type)},isAllowedEventType:function(r){return void 0!==Object.keys(RPEventConstants).map(function(e){return RPEventConstants[e]}).find(function(e){return e===r})},isAllowedOrigins:function(e){for(var r=0;r<this.allowedOrigins.length;r++){var a=e.length-this.allowedOrigins[r].length,t=e.indexOf(this.allowedOrigins[r]),n=e.charAt(t-1);if(t===a&&("."===n||"/"===n))return!0}return!1},subscribeToEvents:function(e){this.handlerFunction=e,void 0!==window.addEventListener?window.addEventListener("message",RPHelperEvents.handleEvent,!1):void 0!==window.attachEvent&&window.attachEvent("onmessage",RPHelperEvents.handleEvent)}};"undefined"!=typeof module&&null!=module.exports&&(RPEventConstants=require("./eventConstants").RPEventConstants,exports.RPHelperEvents=RPHelperEvents);var RPHelper={};function fw_isMobile(){return/android|iphone|ipad|ipod|blackberry|iemobile|opera mini|webos|playbook|silk/i.test(navigator.userAgent)}function getHostname(){return window.location.hostname||""}function addNormalParam(e,r,a){a.kvobj[e]=r}function addParamParam(e,r,a){a.urlType===RPHelper.PLAYER_URL?a.paramsparams[e]=r:addNormalParam(e,r,a)}function playerURLToObj(e){var r=RPHelper.normalizeURL(e),a=r.split("?"),t=a[0],n=a[1]||"",o={};o.baseURL=t,o.urlType=0<=r.split(".")[0].indexOf("link")?RPHelper.SELECTOR_URL:RPHelper.PLAYER_URL,o.kvobj={},o.paramsparams={};var i,l,s=0<n.indexOf("=")?n.split("&"):[];for(i in s)l=s[i].split("="),o.kvobj[l[0]]=l[1];if(o.kvobj.hasOwnProperty("params")){var p=decodeURIComponent(o.kvobj.params);p.indexOf("=")<0&&(p=decodeURIComponent(p));var d=0<p.indexOf("=")?p.split("&"):[];for(i in d)l=d[i].split("="),o.paramsparams[l[0]]=l[1]}return o}function objToPlayerURL(e){var r,a=[],t=[];for(r in e.paramsparams)e.paramsparams[r],t.push(r+"="+e.paramsparams[r]);for(r in e.kvobj.params=encodeURIComponent(t.join("&")),e.kvobj)e.kvobj[r],a.push(r+"="+e.kvobj[r]);var n=a.join("&");return e.baseURL+"?"+n}function addTearsheetSupportSecure(r,e,a){var t=RPHelper.convertParamKeysToLower();if(RPHelper.isProd=e,!("fwcampaignid"in t))return r;var n=t.fwcampaignid,o=r;RPHelper.validateCampaignId(n,function(e){e.result===RPHelper.SUCCESS&&(o=RPHelper.addTearsheetSupport(r)),a(o)})}function addTearsheetSupport(e,r){var a=RPHelper.convertParamKeysToLower();return RPHelper.isProd=r,"fwcampaignid"in a?RPHelper.addTearsheetSupport(RPHelper.normalizeURL(e)):e}function prepSSAI(e,r,a,t,n){var o={fwsitesection:void 0,fallbacksitesectionidmobile:void 0,fallbacksitesectioniddesktop:void 0,mvpd:void 0,adpolicy:void 0,iscoppacompliant:!1};for(var i in r){var l=i.toString().toLowerCase();l in o&&void 0!==r[i]&&(o[l]=r[i])}""===o.mvpd||void 0===o.mvpd||null===o.mvpd?RPHelper.mvpdid=void 0:RPHelper.mvpdid=o.mvpd,""===o.adpolicy||void 0===o.adpolicy||null===o.adpolicy?RPHelper.adPolicy=void 0:RPHelper.adPolicy=o.adpolicy,""!==o.iscoppacompliant?RPHelper.isCoppaCompliant=o.iscoppacompliant:RPHelper.isCoppaCompliant=!1,RPHelper.in_url=RPHelper.normalizeURL(e),RPHelper.ssid=o.fwsitesection,RPHelper.fssid_m=o.fallbacksitesectionidmobile,RPHelper.fssid_d=o.fallbacksitesectioniddesktop,RPHelper.isProd=a,RPHelper.includeGeoInAdRequest=t,RPHelper.completion=n,t?RPHelper.getUserGeoLocation():RPHelper.prepSSAI()}function setAuthToken(e,r){var a=RPHelper.normalizeURL(e);return RPHelper.setAuthToken(a,r)}RPHelper.ltlg={},RPHelper.documentQueryParams={},RPHelper.in_url="",RPHelper.ssid="",RPHelper.fssid_m="",RPHelper.fssid_d="",RPHelper.mvpdid="",RPHelper.adPolicy="",RPHelper.isProd="",RPHelper.includeGeoInAdRequest=!1,RPHelper.completion=void 0,RPHelper.PLAYER_URL="player_url",RPHelper.SELECTOR_URL="selector_url",RPHelper.SUCCESS="success",RPHelper.FAILURE="failure",RPHelper.isCoppaCompliant=!1,RPHelper.AAM_COOKIE_NAME="vpsegs",RPHelper.AAM_PARAM_NAME="aam_segments",RPHelper.FW_ID_COOKIE_NAME="_uid",RPHelper.FW_ID_PARAM_NAME="_fw_vcid2",RPHelper.doQuerySearch=function(e){for(var r,a={},t=/\+/g,n=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(t," "))},i=e;r=n.exec(i);)a[o(r[1])]=o(r[2]);return a},RPHelper.normalizeURL=function(e){return e.slice(0,0<e.indexOf("#")?e.indexOf("#"):e.length)},function(){var e={};for(var r in window.mvpdHashMap)e[r.toString().toLowerCase()]=window.mvpdHashMap[r];window.mvpdHashMap=e,e=null,RPHelper.documentQueryParams=RPHelper.doQuerySearch(window.location.search.substring(1))}(),RPHelper.getUserGeoLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(this.setUserGeoLocation,this.onGeoError):RPHelper.prepSSAI()},RPHelper.setUserGeoLocation=function(e){RPHelper.ltlg={lat:e.coords.latitude,lon:e.coords.longitude},RPHelper.prepSSAI()},RPHelper.onGeoError=function(e){console.warn("RPHelper unable to calculate client location."),RPHelper.prepSSAI()},RPHelper.convertParamKeysToLower=function(){var e={};for(var r in RPHelper.documentQueryParams)e[r.toString().toLowerCase()]=RPHelper.documentQueryParams[r];return e},RPHelper.setAuthToken=function(e,r){var a=playerURLToObj(e);return addParamParam("auth",r,a),objToPlayerURL(a)},RPHelper.addTearsheetSupport=function(e){var r=this.convertParamKeysToLower();if(!("fwcampaignid"in r))return e;var a=playerURLToObj(e);return addParamParam("cookie","_ro%3DCandidate-Ads%3D@@campaignToken@@%3BInternal-Call%3BOpt-Out%3BTesting-Placement%3B%3B".replace("@@campaignToken@@",r.fwcampaignid),a),objToPlayerURL(a)},RPHelper.prepSSAI=function(){var e=this.getAAMCookie(),r=this.getFWuidCookie(),a=playerURLToObj(this.in_url);void 0!==this.mvpdid&&""!==this.mvpdid&&addParamParam("_fw_ae",mvpdHashMap[this.mvpdid.toString().toLowerCase()],a),void 0!==this.adPolicy&&""!==this.adPolicy&&addParamParam("policy",this.adPolicy,a);var t=this.ssid||"";addParamParam("fallbackSiteSectionId",this.fssid_d||"",a),addParamParam("siteSectionId",t,a),fw_isMobile()&&(addParamParam("fallbackSiteSectionId",this.fssid_m||"",a),addParamParam("siteSectionId",t+"_mobile",a)),"manifest"in a.paramsparams||addParamParam("manifest","manifest"in a.kvobj?a.kvobj.manifest:"m3u",a),"switch"in a.paramsparams||addParamParam("switch","switch"in a.kvobj?a.kvobj.switch:"HLSOriginSecure",a),this.includeGeoInAdRequest&&"lat"in this.ltlg&&"lon"in this.ltlg&&addParamParam("ltlg",this.ltlg.lat+","+this.ltlg.lon,a),addNormalParam("MVPDid",this.mvpdid,a),e.length&&addParamParam(this.AAM_PARAM_NAME,e.join(","),a),r&&addParamParam(this.FW_ID_PARAM_NAME,r,a),addParamParam("_fw_h_referer",getHostname(),a),addParamParam("schema","2.0",a),this.ltlg={},void 0!==this.completion&&this.completion(objToPlayerURL(a))},RPHelper.validateCampaignId=function(e,r){var a=new XMLHttpRequest;a.onreadystatechange=function(){var e={result:RPHelper.SUCCESS};4===this.readyState&&(200!==this.status&&(e={result:RPHelper.FAILURE}),r(e))};var t="https://api.freewheel.tv/services/placement/"+e+".xml",n=(RPHelper.isProd,"2d3071db5b2f");a.open("GET",t),a.setRequestHeader("X-FreeWheelToken",n),a.send(null)},RPHelper.parseCookie=function(e){for(var r,a,t=document.cookie.split(";"),n=0;n<t.length;n++)if(r=t[n].substr(0,t[n].indexOf("=")),a=t[n].substr(t[n].indexOf("=")+1),(r=r.replace(/^\s+|\s+$/g,""))===e)return a;return null},RPHelper.getAAMCookie=function(){var e,r=[],a=this.parseCookie(this.AAM_COOKIE_NAME);if(a&&void 0!==(e=a.split("%3D"))[1]&&e[1].match(/\w+/)){var t=e[1].split("%2C");void 0!==t[0]&&(r=t)}return r.slice(0,200)},RPHelper.getFWuidCookie=function(){return this.parseCookie(this.FW_ID_COOKIE_NAME)},"undefined"!=typeof module&&module.exports&&(exports.RPHelper=RPHelper,exports.prepSSAI=prepSSAI,exports.setAuthToken=setAuthToken,exports.addTearsheetSupport=addTearsheetSupport);