/*!
 * Barlesque - ORB and all
 * Copyright (c) 2015 BBC, all rights reserved.
 */
!function(e){var t={inherits:function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.superclass=t.prototype,e.prototype.constructor=e},setStyleAttribute:function(e,t){e.style.setAttribute?e.style.setAttribute("cssText",t):e.setAttribute("style",t)},setStyleBlock:function(e,t){if(e.styleSheet)e.styleSheet.cssText=t;else{if(e.hasChildNodes())for(;e.childNodes.length>=1;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}},getStyle:function(e,t){var i;return e.currentStyle?i=e.currentStyle[t]:window.getComputedStyle&&(i=document.defaultView.getComputedStyle(e,null).getPropertyValue(t)),i},addEvent:function(e,t,i,o){e.addEventListener?e.addEventListener(t,i,o||!1):e.attachEvent?(e["e"+t+i]=i,e[t+i]=function(){var o=window.event,n={target:o.srcElement,type:o.type,keyCode:o.keyCode};e["e"+t+i](n)},e.attachEvent("on"+t,e[t+i])):e["on"+t]=e["e"+t+i]},addEvents:function(e,t,i,o){for(var n=0;n<t.length;++n)this.addEvent(e,t[n],i,o)},matchesSelector:function(e,t){for(var i=document.querySelectorAll(t),o=0;o<i.length;++o)if(i[o]===e)return!0;return!1},findFixedPos:function(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top}},getViewportSize:function(){var e=0,t=0;return window.innerWidth?(e=window.innerWidth,t=window.innerHeight):0!==document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(e=document.body.clientWidth,t=document.body.clientHeight),{x:e,y:t}},createCookie:function(e,t,i,o){var n;if(i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),n="; expires="+r.toGMTString()}else n="";var s=e+"="+t+n+"; path=/";o&&(s+=";domain="+o),document.cookie=s},readCookie:function(e,t){for(var i=e+"=",o=document.cookie.split(";"),n=[],r=0;r<o.length;r++){for(var s=o[r];" "===s.charAt(0);)s=s.substring(1,s.length);0===s.indexOf(i)&&n.push(s.substring(i.length,s.length))}return 0===n.length?null:t?n.join(t):n[0]},readCookiesWithPrefix:function(e){for(var t=document.cookie.split(";"),i={},o=0;o<t.length;o++){for(var n=t[o];" "===n.charAt(0);)n=n.substring(1,n.length);var r=n.split("=");0===r[0].indexOf(e)&&(i[r[0]]=r[1])}return i},eraseCookie:function(e,t){this.createCookie(e,"",-1,t)},areCookiesEnabled:function(){var e=!1,t="edr_sc_tst";return this.createCookie(t,"tst_val",1),null!==this.readCookie(t)&&(e=!0,this.eraseCookie(t)),e},getFlashVersion:function(){function e(e){return e=e.match(/[\d]+/g),e.length=3,e.join(".")}var t=null;if(navigator.plugins&&navigator.plugins.length){var i=navigator.plugins["Shockwave Flash"];i&&i.description?t=e(i.description):navigator.plugins["Shockwave Flash 2.0"]&&(t="2.0.0.11")}else if(navigator.mimeTypes&&navigator.mimeTypes.length){var o=navigator.mimeTypes["application/x-shockwave-flash"];o&&o.enabledPlugin&&(t=e(o.enabledPlugin.description))}else{var n;try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),t=e(n.GetVariable("$version"))}catch(r){try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),t="6.0.21"}catch(s){try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),t=e(n.GetVariable("$version"))}catch(a){}}}}return t?t:null},clone:function(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var i in e)e.hasOwnProperty(i)&&(t[i]=this.clone(e[i]));return t},_ifrRequestCount:0,postToUrl:function(e,t,i,o,n){var r="iframe_req_"+ ++this._ifrRequestCount,s=document.createElement("iframe"),a=i&&"Microsoft Internet Explorer"===navigator.appName;a&&(s.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"),s.setAttribute("id",r),s.setAttribute("name",r),s.setAttribute("tabindex",-1),this.setStyleAttribute(s,"position:absolute;left:-100000px;top:-100000px;"),document.body.appendChild(s),window.frames&&window.frames[r]&&(s=window.frames[r]),s.name=r;var l=function(){s.contentDocument||s.document;n=n||"post";var i=document.createElement("form");i.setAttribute("method",n),i.setAttribute("action",e);for(var a in t)if(t.hasOwnProperty(a)){var l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name",a);var h=t[a];h="object"==typeof h?JSON.stringify(h):h,l.setAttribute("value",h),i.appendChild(l)}i.setAttribute("target",r),document.body.appendChild(i),i.submit();var d=function(){var e=null;try{e=s.contentDocument||s.document}catch(t){}e?setTimeout(d,10):(document.body.removeChild(i),document.body.removeChild(document.getElementById(r)),o&&o())};setTimeout(d,10)};a?setTimeout(l,1):l()},genGuid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},arrayIndexOf:function(e,t){"use strict";if(Array.prototype.indexOf)return e.indexOf(t);if(null===e)throw new TypeError;var i=Object(e),o=i.length>>>0;if(0===o)return-1;var n=0;if(arguments.length>2&&(n=Number(arguments[2]),n!=n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=o)return-1;for(var r=n>=0?n:Math.max(o-Math.abs(n),0);r<o;r++)if(r in i&&i[r]===t)return r;return-1},isIEOrEdge:function(){return!!(document.all&&document.querySelector||"-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style||/Edge\/\d+./i.test(navigator.userAgent))},isAndroid:function(){return navigator.userAgent.toLowerCase().indexOf("android")>-1},isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},iOSVersion:function(){if(this.isIOS()){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}},executesInactiveTabs:function(){var e=this.iOSVersion();return!e||e[0]>=8},getVisibilityChangeEventNames:function(){var e,t;return"undefined"!=typeof document.hidden?(e="hidden",t="visibilitychange"):"undefined"!=typeof document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),{hidden:e,visibilitychange:t}}};e.EDRUtility=t}(window),function(e){var t=this,i=e.EDRUtility,o={};o.createFromConfig=function(e){var t={};if(e)for(var i in e)if(e.hasOwnProperty(i)){var n=o.Probe.create(i,e[i]);n&&(t[i]=n)}return t},o.execute=function(e,t,i){var o={};for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if("push"==r.config.kind){var s=i[r.config.code];r.pushedValue=void 0!==s?s:null}o[n]=r.getValue(e)}return o},o.Probe=function(e,t){this.config=t,this.pushedValue=null},o.Probe.create=function(e,t){switch(t.kind){case"resultHistory":return new o.Probe.ResultHistory(e,t);case"cookieValue":case"elementContent":case"pageUrl":return new o.Probe.String(e,t);case"cookieExists":case"elementExists":case"elementVisible":return new o.Probe.Boolean(e,t);case"elementCount":return new o.Probe.Number(e,t);case"push":switch(t.type){case"bool":return new o.Probe.Boolean(e,t);case"string":return new o.Probe.String(e,t);case"number":return new o.Probe.Number(e,t);default:return null}break;default:return null}},o.Probe.String=function(e,t){try{this._regEx=t.regex?new RegExp(t.regex):null}catch(i){}this._returnAll=!1,this._returnIndex=0,this._visibleOnly=t.visibleOnly===!0,t.returnAll?this._returnAll=!0:this._returnIndex=t.index?t.index:0,o.Probe.call(this,e,t)},i.inherits(o.Probe.String,o.Probe),o.Probe.String.prototype.getValue=function(e){var t=[];switch(this.config.kind){case"cookieValue":var o=i.readCookie(this.config.cookieName);o&&t.push(o);break;case"elementContent":for(var n=e.document.querySelectorAll(this.config.selector),r=0;r<n.length;++r)if(!this._visibleOnly||0!==n[r].offsetWidth){var s=n[r].textContent||n[r].innerText;t.push(s)}break;case"pageUrl":t.push(e.document.location.href);break;case"push":t.push(this.pushedValue)}if(this._regEx){for(var a=[],l=0;l<t.length;++l){var h=this._regEx.exec(t[l]);if(h&&1===h.length)a.push(t[l]);else if(h)for(var d=1;d<h.length;++d)a.push(h[d])}t=a}if(this._returnAll)return t;var u=this._returnIndex;return u<0?null:u>=t.length?null:t[u]},o.Probe.Boolean=function(e,t){o.Probe.call(this,e,t)},i.inherits(o.Probe.Boolean,o.Probe),o.Probe.Boolean.prototype.getValue=function(e){var t=!1;switch(this.config.kind){case"cookieExists":t=null!==i.readCookie(this.config.cookieName);break;case"elementExists":t=null!==e.document.querySelector(this.config.selector);break;case"elementVisible":for(var o=e.document.querySelectorAll(this.config.selector),n=0;n<o.length;++n)if(0!==o[n].offsetWidth){t=!0;break}break;case"push":t=this.pushedValue}return this.config.not&&(t=!t),t},o.Probe.Number=function(e,t){o.Probe.call(this,e,t)},i.inherits(o.Probe.Number,o.Probe),o.Probe.Number.prototype.getValue=function(e){switch(this.config.kind){case"elementCount":return e.document.querySelectorAll(this.config.selector).length;case"push":return this.pushedValue}},o.Probe.ResultHistory=function(e,t){this._allowDuplicates=t.allowDuplicates===!0,this._innerProbe=o.Probe.create(e+"_inner",t.innerProbe),this._lastResult=null,this._collection=[],o.Probe.call(this,e,t)},i.inherits(o.Probe.ResultHistory,o.Probe),o.Probe.ResultHistory.prototype.getValue=function(e){var t=this._innerProbe.getValue(e);if(JSON.stringify(t)===JSON.stringify(this._lastResult))return this._collection;this._lastResult=t;var i="[object Array]"===Object.prototype.toString.call(t);t=i?t:[t];for(var o=0;o<t.length;++o){if(!this._allowDuplicates){for(var n=!1,r=0;r<this._collection.length;++r)if(t[o]===this._collection[r].val){n=!0;break}if(n)continue}this._collection.push({dt:Math.round((new Date).getTime()/1e3),val:t[o]})}return this._collection},t.EDRSurveyCodeProbes=o}(window),function(e,t,i,o){var n=this,r={_lastChannelId:0,Rpc:function(i,n){if(n.local)for(var s in n.local)if(n.local.hasOwnProperty(s)){var a=n.local[s];"function"==typeof a&&(n.local[s]={method:a})}var l="edr"+r._lastChannelId++,h=t.createElement("iframe");return h.id=h.name=i.props.id,h.border=h.frameBorder=0,h.allowTransparency=!0,h.src=i.remote+"&xdm_o="+o(r._getLocation(e.location.toString()))+"&xdm_c="+l,t.getElementById(i.container).appendChild(h),new r.RpcBehaviour(i,n,h,r._getLocation(i.remote),l)},_getLocation:function(e){var t=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,i=e.toLowerCase().match(t),o=i[2],n=i[3],r=i[4]||"";return("http:"===o&&":80"===r||"https:"===o&&":443"===r)&&(r=""),o+"//"+n+r}};r.RpcBehaviour=function(t,o,n,r,s){function a(e,t){var i=Array.prototype.slice;return function(){var e={method:t,params:i.call(arguments,0)};n.contentWindow.postMessage(JSON.stringify(e),r)}}function l(e,t,i){t.method.apply(t.scope,i)}function h(e){if(e.origin===r){var n;try{n=JSON.parse(e.data)}catch(e){return}if(n.channel===s)return n.internal?void(d||"-ready-"===n.internal&&(i(t.onReady,0),d=!0)):void l(n.method,o.local[n.method],n.params)}}var d=!1;for(var u in o.remote)o.remote.hasOwnProperty(u)&&(this[u]=a(o.remote[u],u));e.addEventListener?e.addEventListener("message",h,!1):e.attachEvent("onmessage",h)},n.eDRXDMClient=r,n.eDRXDMClient.Rpc=r.Rpc}(window,document,window.setTimeout,encodeURIComponent),/**
                                                             * @preserve Maru/edr survey code v7.2.8.1
                                                             *   Copyright (C) 2012 Maru/edr all rights reserved.
                                                             *   http://www.maruedr.com
                                                             */
function(e,t,i,o,n,r,s,a,l,h){var d=this,u=e.EDRUtility,c=e.EDRSurveyCodeProbes;if("undefined"!=typeof d.EDRSurvey)return void d.EDRSurvey.getTester().log(33,null,null,4);var g={};g.TRACKING_COOKIE_NAME="eds_uuid",g.TRACKING_DAYS_DISABLED=-1,g.PageState={pageViewCount:0,documentDomainExplicitlySet:!1,_timeLoaded:null,init:function(){if(this._timeLoaded=new Date,this.documentDomainExplicitlySet=t.location.hostname!==t.domain,!this.documentDomainExplicitlySet){var e=t.createElement("iframe");t.body.appendChild(e);try{e.contentWindow.document}catch(i){this.documentDomainExplicitlySet=!0}e.parentNode.removeChild(e)}},getMillisecondsSincePageLoad:function(){var e=new Date;return e-this._timeLoaded}},g.Layer=function(i,n,r){i=i?i:null,this.MAX_WAIT_FOR_CONFIGURE=3e4,this.MAX_WAIT_FOR_LOAD=1250,this.MAX_HIDE_TIME=2e3,this.HIDDEN_STYLE="position:absolute;left:-100000px;top:-100000px;width:100%;height:100%;",this.id=i,this.logId=i?i:"initial",this.name=null,this.div=null,this.iframe=null,this.showing=!1,this.everShown=!1,this.everShownOnPage=!1,this._deploymentId=null,this._rootDeploymentId=n,this._rootLanguage=r,this._rpc=null,this._styleBlock=null,this._divId="edr_lwrap_"+(i?i:"first"),this._iframeId="edr_l_"+(i?i:"first"),this._iframeStyles=null,this._positioner=null,this._layout=null,this._deploy={},this._ticker=null,this._initialised=!1,this._configured=!1,this._triggeringElement=null,this._globalConditionals=[],this._triggers=[],this._configureTimeoutTimer=null,this._iframeCheckTimeoutTimer=null,this._globalConditionalsHidShowingLayerTrigger=null,this._hiding=!1,this._lightboxElement=null,this._lightboxAnimationStepper=null,this._probeConfiguration={},this._surveyWin=null,this._loggedCanShowEventDeniedShow=!1,this._clickToHide=!1,this._initialFocusHandled=!1;var s=("undefined"!=typeof e.postMessage&&null!==e.postMessage,{xdm:"edr"});i&&(s.lid=i),r&&(s.rlang=r),g.Tester.log(5,this.logId,s.xdm);var a,l=this.div=t.createElement("div"),h=e.eDRXDMClient,d=t.getElementsByTagName("head")[0],c=this._styleBlock=t.createElement("style"),y=this;l.id=this._divId,l.className="edr_lwrap",l.setAttribute("title","Online Quality Survey"),l.setAttribute("aria-label","Online Quality Survey"),l.setAttribute("role","alertdialog"),t.getElementById("edr_survey").appendChild(l);var p=this;this._rpc=a=new h.Rpc({remote:g.Main.buildUrl("l",s),container:this._divId,props:{id:this._iframeId},onReady:function(){a.hostReady()}},{remote:{alertMessage:{},hostReady:{},onShown:{},onHidden:{},requestMetrics:{},onAnchorEdgesChanged:{},hide:{},prepareSurvey:{},setHoverState:{},setFocusState:{},onConfigured:{},focusFirst:{}},local:{alertMessage:function(e){alert("received by survey code: "+e)},initialise:function(e,t){y.initialise(e,t)},configureLayer:function(e,t,i,o,n,r){y.configure(e,t,i,o,n,r)},hide:function(){y.hide()},forceHide:function(){y.forceHide()},showLightbox:function(){y.showLightbox()},hideLightbox:function(){y.hideLightbox()},destroyLayer:function(){y.destroy("close")},deployAdditionalLayers:function(e){for(var t=0;t<e.length;t++)g.Main.deployLayer(e[t])},deployAdditionalDeployments:function(e){for(var t=0;t<e.length;t++)g.Main.deployDeployment(e[t],p._rootDeploymentId,p._rootLanguage)},triggerLayerByName:function(e){var t=g.Main.getLayerByName(e);t&&t.trigger(y.div)},setMetrics:function(e,t){y._setMetrics(e,t)},activateTestMode:function(e){g.Tester.activate(e)},execute:function(){y.execute()},logServerItems:function(e){for(var t=0;t<e.length;++t)g.Tester.serverLog(y.logId,e[t])},updateCookie:function(e){u.createCookie(EDRSurvey.COOKIE_NAME,e,36500,g.Main.DOMAIN)},log:function(e,t){g.Tester.providerLog(y.logId,e,t)}}}),c.type="text/css",d.appendChild(c),u.setStyleBlock(c,"#"+this._divId+" {"+this.HIDDEN_STYLE+"}");var _=function(){if(p.iframe=t.getElementById(p._iframeId),p.iframe){p.iframe.setAttribute("scrolling","no"),g.Main.onLayerInitialised(i,p);var e=function(){var t=null;try{t=p.iframe.contentDocument||p.iframe.document}catch(i){}t?p._iframeCheckTimeoutTimer=o(e,10):p._iframeCheckTimeoutTimer=o(function(){p._initialised||(g.Tester.log(42,p.logId,[p.MAX_WAIT_FOR_LOAD]),g.EventHub.raise(g.EventHub.LAYER_WONT_SHOW,{layer:this}),p.destroy())},p.MAX_WAIT_FOR_LOAD)};p._iframeCheckTimeoutTimer=o(e,10),p._configureTimeoutTimer=o(function(){g.Tester.log(12,p.logId,null,4),g.EventHub.raise(g.EventHub.LAYER_WONT_SHOW,{layer:this}),p.destroy()},p.MAX_WAIT_FOR_CONFIGURE),p._tick()}else o(_,10)};_(),g.Tester.log(6,this.logId)},g.Layer.prototype.getName=function(){return this.name},g.Layer.prototype.getDeployment=function(){return new g.Deployment(this._deploy)},g.Layer.prototype.requestCurrentMetrics=function(){this._rpc.requestMetrics()},g.Layer.prototype.setHoverState=function(e,t){this._rpc.setHoverState(e,t)},g.Layer.prototype.setFocusState=function(e,t){this._rpc.setFocusState(e,t)},g.Layer.prototype.onAnchorEdgesChanged=function(e){this._rpc.onAnchorEdgesChanged(e)},g.Layer.prototype.initialise=function(e,t){!this._rootDeploymentId&&e&&(this._rootDeploymentId=e),t&&(this._rootLanguage=t),this._initialised=!0},g.Layer.prototype.configure=function(e,i,o,r,s,a){if(g.Tester.log(7,this.logId,e),this.name=e,this.iframe.className=g.Main.LAYER_IFRAME_CLASS+" edr_layer_name_"+e,this._iframeStyles=i,this._layout=r,this._deploy=s,this._probeConfiguration=a,this._deploymentId=this._parseDeploymentId(this._deploy.deploymentId)[0],r.lightbox&&!this._lightboxElement?this._createLightbox():!r.lightbox&&this._lightboxElement&&this._destroyLightbox(),r.clickToHide&&(this._clickToHide=!0),this._configureJSBehaviour(),this._triggers=[new g.TriggerManual],this._globalConditionals=[],o){var l,h=o.triggers,d=o.globalConditionals;if(h)for(l=0;l<h.length;++l)this._triggers.push(g.Trigger.create(h[l]));if(d)for(l=0;l<d.length;++l)this._globalConditionals.push(g.Conditional.create(d[l]))}var c="#"+this._divId+"{";c+=this.HIDDEN_STYLE+"z-index:"+g.Main.ZINDEX_ON_TOP+";";var y=t.getElementById(this._divId);y&&y.removeAttribute("style");for(var p in this._iframeStyles)this._iframeStyles.hasOwnProperty(p)&&(c+=p+":"+this._iframeStyles[p]+";");c+="}",u.setStyleBlock(this._styleBlock,c),this.everShown=this._isPersistedCookieSet(),this._rpc.onConfigured({everShown:this.everShown}),g.EventHub.raise(g.EventHub.LAYER_INITIALISED,this),this._configured?this.showing&&this._show(this._triggeringElement):(this._configured=!0,n(this._configureTimeoutTimer),n(this._iframeCheckTimeoutTimer),this._configureTimeoutTimer=null,this._iframeCheckTimeoutTimer=null)},g.Layer.prototype._parseDeploymentId=function(e){return e?e.split("|"):(g.Tester.log(43,this.logId,null,3),null)},g.Layer.prototype._setOpacity=function(e,t,i){var o=Math.round(100*t);u.setStyleAttribute(e,"background-color:"+i+";opacity:"+t+";filter: alpha(opacity="+o+");display:block;")},g.Layer.prototype._tweenLbOpacity=function(e,t){var i=this._layout.lightbox,o=parseFloat(i.opacity);s(this._lightboxAnimationStepper);var n=e?1:0,a=this;this._lightboxAnimationStepper=r(function(){a._setOpacity(a._lightboxElement,n*o,i.colour),n+=e?-.05:.05,(!e&&n>=1||e&&n<=0)&&(s(a._lightboxAnimationStepper),a._lightboxAnimationStepper=null,t&&t())},10)},g.Layer.prototype._isPersistedCookieSet=function(){var e=u.readCookie(g.Main.COOKIE_FORCED_CONFIG_PREFIX+this.getDeploymentId());return!!e},g.Layer.prototype.showLightbox=function(){if(this._lightboxElement){var e=this._layout.lightbox;e.fade?this._tweenLbOpacity(!1):this._setOpacity(this._lightboxElement,e.opacity,e.colour),g.Main.flagLightboxDisplayed(this.id)}},g.Layer.prototype.hideLightbox=function(){if(this._lightboxElement){var e=this,t=function(){u.setStyleAttribute(e._lightboxElement,""),g.Main.flagLightboxHidden(e.id)};this._layout.lightbox.fade?this._tweenLbOpacity(!0,t):t()}},g.Layer.prototype.trigger=function(e){this._triggers[0].setTriggered(e)},g.Layer.prototype.onEvent=function(e){if(this._configured){if("keyup"===e.type&&27===e.keyCode&&this._lightboxElement&&this._lightboxElement.offsetWidth&&this.destroy("close"),e.target&&e.target.classList.contains(g.Main.GO_CLICK_CAPTURER_CLASS)&&this._positioner){if(!this._positioner.isClickCapturer(e.target))return;switch(e.type){case"click":this.execute();break;case"mouseover":this.setHoverState(e.target.id,!0);break;case"mouseout":this.setHoverState(e.target.id,!1);break;case"focus":this._clickCapturerFocusChanged(e.target.id,!0);break;case"blur":this._clickCapturerFocusChanged(e.target.id,!1)}}else"click"===e.type&&this._clickToHide&&this.showing&&this.hide();for(var t=0;t<this._triggers.length;++t)this._triggers[t].onEvent(e,g.PageState,this)}},g.Layer.prototype._clickCapturerFocusChanged=function(e,i){var n=this;o(function(){t.activeElement===n.iframe&&n.focusFirst()}),this.setFocusState(e,i)},g.Layer.prototype._tick=function(){if(n(this._ticker),this._configured){var t={layer:this,canShow:!0};g.EventHub.raise(g.EventHub.LAYER_CAN_SHOW,t);var i=t.canShow;if(i){for(var r=0;r<this._globalConditionals.length;++r)if(!this._globalConditionals[r].isTrue(null)){i=!1;break}}else this._loggedCanShowEventDeniedShow||(g.Tester.log(31,this.logId,null,4),this._loggedCanShowEventDeniedShow=!0);if(i){if(this._globalConditionalsHidShowingLayerTrigger)this._show(this._globalConditionalsHidShowingLayerTrigger===!0?null:this._globalConditionalsHidShowingLayerTrigger);else{for(var s=0;s<this._triggers.length;++s)this._triggers[s].evaluate(g.PageState,this);var a=null,l=!1,h=!1;for(s=0;s<this._triggers.length;++s){var d=this._triggers[s];if(d.checkTriggerChanged()){l=!0;var u=this._triggers[s].getTriggeringElement();u&&(h=!0,u!==e&&(a=u))}}l&&(this.showing&&a&&a!==this._triggeringElement&&this.forceHide(!0),h&&!this.showing?this._show(a):!h&&this.showing&&this.hide())}this._globalConditionalsHidShowingLayerTrigger=null}else this.showing&&(this._globalConditionalsHidShowingLayerTrigger=!this._triggeringElement||this._triggeringElement,this.forceHide(!0))}var c=this;this._ticker=o(function(){c._tick()},100)},g.Layer.prototype._show=function(i){if(g.Tester.log(8,this.logId,i),!this._configured)return!1;var o=u.clone(this._layout),n=o.position.relativeTo;if(!n)return this.destroy(),!1;var r;switch(n){case"window":r=e;break;case"document":r=e.document;break;default:r="trigger"===n?i:t.querySelector(n),r||(r=e,o.position.edges=["top","left","bottom","right"],o.position.offset={x:0,y:0})}if(this.showing){if(!this._positioner)throw"EDRSurveyCode.PositionedLayer not available when showing in show()";this._positioner.destroy()}else u.setStyleAttribute(this.div,this.HIDDEN_STYLE),this._layout.lightbox&&this._layout.lightbox.show&&this.showLightbox();this._positioner=new g.PositionedLayer(this,r,this._iframeStyles,o),this.showing=!0,this._triggeringElement=i;var s=!0;this.everShown||(s=this._isPersistedCookieSet()),this.everShown=s,this._deploy.persistDeployment&&this.getDeploymentId()&&this._setPersistenceCookie();var a=this._getSurveyEntryData();return a.surveyId=this._deploy.surveyId,a.installationId=this._deploy.installationId,a.deploymentId=this.getDeploymentId(),a.rootDeploymentId=this._rootDeploymentId,this._rpc.onShown(a),this.everShown||u.postToUrl(g.Main.eDRUrlBase+"log.php?e=layershow",this._deploy,g.PageState.documentDomainExplicitlySet),g.EventHub.raise(g.EventHub.LAYER_SHOWN,{layer:this,firstShow:!this.everShown,firstShowOnPage:!this.everShownOnPage}),this.everShown=this.everShownOnPage=!0,!0},g.Layer.prototype._removePersistenceCookie=function(e){var t=g.Main.COOKIE_FORCED_CONFIG_PREFIX+e,i=u.readCookie(t);i&&u.eraseCookie(t,g.Main.DOMAIN)},g.Layer.prototype._setPersistenceCookie=function(){var e=this.getDeploymentId();if(!e)return void g.Tester.log(41,this.logId);var t=g.Main.COOKIE_FORCED_CONFIG_PREFIX+e,i=31536e4,o=this._deploy.persistDeploymentDuration,n=u.readCookie(t);if(!n){var r=!1;o!==!1&&(0===o&&(o=i),r=o/86400);var s=JSON.stringify({rdi:this._rootDeploymentId?this._rootDeploymentId:1,rl:this._rootLanguage?this._rootLanguage:""});u.createCookie(t,s,r,g.Main.DOMAIN),g.Tester.log(39,this.logId,[this.getDeploymentId(),s])}},g.Layer.prototype.getDeploymentId=function(){return this._deploymentId},g.Layer.prototype.hide=function(){if(!this._hiding){g.Tester.log(9,this.logId),this._hiding=!0,this.hideLightbox(),this._rpc.hide();var t=this;e.setTimeout(function(){t._hiding&&(g.Tester.log(13,t.logId,[t.MAX_HIDE_TIME],4),t.forceHide())},this.MAX_HIDE_TIME)}},g.Layer.prototype.forceHide=function(e){if(this._hiding=!1,this.showing){if(g.Tester.log(10,this.logId),!e)for(var t=0;t<this._triggers.length;++t)this._triggers[t].setUntriggered();u.setStyleAttribute(this.div,this.HIDDEN_STYLE+"visibility:hidden;"),this.showing=!1,this._loggedCanShowEventDeniedShow=!1,this._triggeringElement=!1,this._initialFocusHandled=!1,this._positioner&&(this._positioner.destroy(),this._positioner=null),this._rpc.onHidden(),g.EventHub.raise(g.EventHub.LAYER_HIDDEN,{layer:this})}},g.Layer.prototype.focusFirst=function(){this._rpc.focusFirst()},g.Layer.prototype._setMetrics=function(e,t){this._positioner&&(this._positioner.setMetrics(e,t),this._handleInitialFocus())},g.Layer.prototype._handleInitialFocus=function(){this._positioner&&this._lightboxElement&&!this._initialFocusHandled&&(this._initialFocusHandled=!0,this._positioner.focusFirstClickCapturer())},g.Layer.prototype.destroy=function(e){g.Tester.log(11,this.logId),this._runDePersist(),n(this._ticker),this._configureTimeoutTimer&&n(this._configureTimeoutTimer),this._iframeCheckTimeoutTimer&&n(this._iframeCheckTimeoutTimer),this._positioner&&this._positioner.destroy(),this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this._styleBlock&&this._styleBlock.parentNode&&this._styleBlock.parentNode.removeChild(this._styleBlock),this.div&&this.div.parentNode&&this.div.parentNode.removeChild(this.div),this._lightboxElement&&this._destroyLightbox(),this._ticker=null,this._configureTimeoutTimer=null,this._iframeCheckTimeoutTimer=null,this._positioner=null,this.iframe=null,this.div=null,this._styleBlock=null,this._rpc=null,this._lightboxElement=null,g.Main.onLayerDestroyed(this.id),g.EventHub.raise(g.EventHub.LAYER_DESTROYED,{layerName:this.getName()}),void 0!==e&&g.EventHub.raise(g.EventHub.LAYER_INTERACTED,{layer:this,action:e})},g.Layer.prototype._runDePersist=function(){if(this._deploy.depersistDeploymentId){var e=this._deploy.depersistDeploymentId;this._deploy.depersistDeploymentId=null;var t=g.Main.getLayerByDeploymentId(e);t&&t.destroy(),this._removePersistenceCookie(e),g.Tester.log(40,this.logId,e)}},g.Layer.prototype.execute=function(){if(this._deploy){switch(g.EventHub.raise(g.EventHub.LAYER_EXECUTED,{layer:this,action:this._deploy.type}),g.EventHub.raise(g.EventHub.LAYER_INTERACTED,{layer:this,action:"executed"}),this._runDePersist(),this._deploy.type){case"triggerOtherLayer":var e=g.Main.getLayerByName(this._deploy.otherLayerName);e&&e.trigger(this.div);break;case"deployOtherDeployment":var t=g.Main.getLayerById(this._deploy.onExecuteDeploymentId);if(t)g.Tester.log(38,this.logId,this._deploy.onExecuteDeploymentId),t.trigger(this.div);else{g.Tester.log(36,this.logId,this._deploy.onExecuteDeploymentId);var i=this._deploy.rootDeploymentId?this._deploy.rootDeploymentId:this._rootDeploymentId?this._rootDeploymentId:this._deploy.deploymentId,o=this._deploy.rootLanguage?this._deploy.rootLanguage:this._rootLanguage;g.Main.deployDeployment(this._deploy.onExecuteDeploymentId,i,o)}break;case"popupSurvey":this._deployPopupSurvey(this._deploy);break;case"exitSurvey":this._deployExitSurvey(this._deploy);break;case"embeddedSurvey":}this._deploy.keepLayerOnExecute?g.Tester.log(37,this.logId):this.destroy()}else this.destroy()},g.Layer.prototype._deployPopupSurvey=function(e,t){var i=u.genGuid(),o=g.Main.eDRUrlBase+"deploy/"+(t?"enter-exit-survey-no-holding":"enter")+"/guid/"+i+"/installation/"+e.installationId,n=this._surveyWin,r=this._deploy.windowSize,s=u.executesInactiveTabs(),a=this._getSurveyEntryData();a.surveyId=e.surveyId,a.installationId=e.installationId,a.deploymentId=e.deploymentId,a.rootDeploymentId=this._rootDeploymentId,u.postToUrl(g.Main.eDRUrlBase+"prepare.php?guid="+i,a,g.PageState.documentDomainExplicitlySet,s?function(){n.location=o}:void 0),t?(this._surveyWin=n=t,r.x&&r.y&&(n.resizeTo?n.resizeTo(r.x,r.y):(n.outerWidth=r.x,n.outerHeight=r.y))):this._surveyWin=n=this._openWindow(s?"about:blank":o,"edr_win_"+this.name,r.x,r.y)},g.Layer.prototype._configureJSBehaviour=function(){switch(this._layout.jsBehaviour){case 0:break;case 1:this._configureFloatingLayerBehaviour()}},g.Layer.prototype._createLightbox=function(){var e=t.createElement("div");e.className="edr_lb",t.getElementById("edr_survey").appendChild(e),this._lightboxElement=e},g.Layer.prototype._destroyLightbox=function(){this._lightboxAnimationStepper&&(s(this._lightboxAnimationStepper),this._lightboxAnimationStepper=null),g.Main.flagLightboxHidden(this.id),this._lightboxElement&&this._lightboxElement.parentNode&&this._lightboxElement.parentNode.removeChild(this._lightboxElement),this._lightboxElement=null},g.Layer.prototype._configureFloatingLayerBehaviour=function(){g.Tester.log(35,this.logId)},g.Layer.prototype._deployExitSurvey=function(i){function n(e){if(++p>_/f)return void(h||(e.close(),e=null,g.Tester.log(24,m.logId,null,3)));try{if(!e.document||h&&c===e.document)throw"wait"}catch(s){return void o(function(){n(e)},f)}if(e.document.getElementById){g.Tester.log(27,m.logId),h=!0;try{var a=e.document.getElementsByTagName("body");a&&(a[0].innerHTML="")}catch(s){}var d=g.Main.eDRUrlBase+"deploy/holding/deployment/"+i.deploymentId;m._rootDeploymentId&&(d+="/rdi/"+m._rootDeploymentId),d+="/survey/"+l(i.surveyId),d+="/installation/"+l(i.installationId),g.PageState.documentDomainExplicitlySet&&(d+="/doc-domain/"+l(t.domain)),r.locale&&(d+="/locale/"+l(r.locale)),c=e.document,e.document.write('<!DOCTYPE html><SCRIPT LANGUAGE="Javascript">'+(g.PageState.documentDomainExplicitlySet?'document.domain = "'+t.domain+'";':"")+"var pc = "+JSON.stringify(m._probeConfiguration)+";var ppv = "+JSON.stringify(g.Main.pushedProbeValues)+";var sed = "+JSON.stringify(r)+";var dply = "+JSON.stringify(i)+";</SCRIPT>"),e.document.write('<SCRIPT LANGUAGE="Javascript" ASYNC SRC="'+d+'"></SCRIPT>'),u.isIOS()&&o(function(){n(e)},f)}else g.Tester.log(25,m.logId,null,3),m._deployPopupSurvey(i,e)}g.Tester.log(26,this.logId);var r=this._getSurveyEntryData();r.surveyId=i.surveyId,r.installationId=i.installationId,r.deploymentId=i.deploymentId,r.rootDeploymentId=this._rootDeploymentId;var s=g.PageState.documentDomainExplicitlySet&&u.isIEOrEdge(),a=this._deploy.holdingWindowSize,h=!1,d=u.getVisibilityChangeEventNames();eventWriteFn=function(t){t=t||e.event,t.type===d.visibilitychange&&(e.document.removeEventListener(d.visibilitychange,eventWriteFn),h||n(m._surveyWin))},d.hidden in e.document&&e.document.addEventListener(d.visibilitychange,eventWriteFn),this._surveyWin=this._openWindow(s?g.Main.holdingWindowAccessDocument:"about:blank","_blank",a.x,a.y);var c;try{c=this._surveyWin.document}catch(y){c=null}var p=0,_=2e3,f=20,m=this;o(function(){o(function(){n(m._surveyWin)},0)},0)},g.Layer.prototype._getSurveyEntryData=function(){var t=c.execute(e,c.createFromConfig(this._probeConfiguration),g.Main.pushedProbeValues),i=g._getId();return{url:e.location.href,probes:t,locale:g.Main.LOCALE,data1:g.Main.DATA1,data2:g.Main.DATA2,data3:g.Main.DATA3,test:g.Main.TEST,uuid:null!==i?i:""}},g.Layer.prototype._openWindow=function(t,i,o,n){var r=u.isIOS()||u.isAndroid(),s=r?null:"location=0,toolbar=no,directories=no,status=no,scrollbars=yes,resizable=yes";return!r&&o&&n&&(s+=",width="+o+",height="+n),e.open(t,i,s)},g.Deployment=function(e){this._config=e},g.Deployment.prototype.getSurveyId=function(){return this._config.surveyId},g.Deployment.prototype.getInstallationId=function(){return this._config.installationId},g.Deployment.prototype.getLayerId=function(){return this._config.humanIds.layerId},g.Deployment.prototype.getDeploymentId=function(){return this._config.humanIds.deploymentId},g.Deployment.prototype.getDeployId=function(){return this._config.humanIds.deployId},g.Deployment.prototype.getTriggerId=function(){return this._config.humanIds.triggerpointId},g.Deployment.prototype.getType=function(){return this._config.type},g.Trigger=function(e){this._config=e,this._triggeringElement=null,this._triggeringElementChanged=!1,this._conditions=[];var t=e.conditionals;if(t)for(var i=0;i<t.length;++i)this._conditions.push(g.Conditional.create(t[i]))},g.Trigger.create=function(e){switch(e.type){case"init":return new g.TriggerInit(e);case"click":return new g.TriggerClick(e);case"scroll":return new g.TriggerScroll(e);default:g.Tester.log(16,null,[e.type],2)}},g.Trigger.prototype.evaluate=function(e,t){},g.Trigger.prototype.onEvent=function(e,t,i){},g.Trigger.prototype._doConditionsPass=function(e){for(var t=0;t<this._conditions.length;++t)if(!this._conditions[t].isTrue(e))return!1;return!0},g.Trigger.prototype.setTriggered=function(t){var i=t||e;i!==this._triggeringElement&&(g.Tester.log(14,this._config.type,t),this._triggeringElementChanged=!0,this._triggeringElement=i)},g.Trigger.prototype.setUntriggered=function(){this._triggeringElement&&(g.Tester.log(15,this._config.type),this._triggeringElementChanged=!0,this._triggeringElement=null)},g.Trigger.prototype.getTriggeringElement=function(){return this._triggeringElement},g.Trigger.prototype.checkTriggerChanged=function(){var e=this._triggeringElementChanged;return this._triggeringElementChanged=!1,e},g.TriggerManual=function(){g.Trigger.call(this,{type:"manual"})},u.inherits(g.TriggerManual,g.Trigger),g.TriggerInit=function(e){g.Trigger.call(this,e),this._disabled=!1},u.inherits(g.TriggerInit,g.Trigger),g.TriggerInit.prototype.evaluate=function(e,t){if(!t.everShownOnPage&&!this._disabled)return this._doConditionsPass()?void(this._config.delay?e.getMillisecondsSincePageLoad()>parseInt(this._config.delay,10)&&this.setTriggered():this.setTriggered()):(g.Tester.log(17,this._config.type,null,4),void(this._disabled=!0))},g.TriggerClick=function(e){g.Trigger.call(this,e),this._triggering=!1},u.inherits(g.TriggerClick,g.Trigger),g.TriggerClick.prototype.onEvent=function(e,t,i){if("click"===e.type&&this._config.selector&&u.matchesSelector(e.target,this._config.selector))if(this._triggeringElement&&e.target===this._triggeringElement)this.setUntriggered();else if(!this._triggering)if(this._doConditionsPass(e.target)){var n=this,r=function(){n._triggering=!1,n.setTriggered(e.target)};this._config.delay&&!i.showing?(this._triggering=!0,o(r,this._config.delay)):r()}else g.Tester.log(18,this._config.type,e.target,4)},g.TriggerScroll=function(e){this._repeatable=!!e.repeatable,this._docScroll={update:function(){for(var e=["scrollTop","scrollLeft"],i=0;i<e.length;++i)t.body&&t.body[e[i]]?this[e[i]]=t.body[e[i]]:t.documentElement&&t.documentElement[e[i]]?this[e[i]]=t.documentElement[e[i]]:t.documentElement&&!t.documentElement[e[i]]&&(this[e[i]]=0)}},g.Trigger.call(this,e)},u.inherits(g.TriggerScroll,g.Trigger),g.TriggerScroll.prototype.evaluate=function(i,o){var n=this._config.element;if(n){var r=this._config.axes;if(r){var s={x:"scrollLeft",y:"scrollTop"},a=!1,l=function(e,t,i){var o=parseInt(i,10);if(i.indexOf("%")!==-1){var n="y"===t?e.offsetHeight:e.offsetWidth;o=n*(o/100)}return o},h=[],d=null;"document"===n?(this._docScroll.update(),h=[this._docScroll],d=e.document.body):h=t.querySelectorAll(n);for(var u=0;u<h.length;++u)for(var c in s)if(s.hasOwnProperty(c)&&r[c]){var g=r[c].lowerBound,y=r[c].upperBound,p=null===g||void 0===g||h[u][s[c]]>=l(d?d:h[u],c,g),_=null===y||void 0===y||h[u][s[c]]<=l(d?d:h[u],c,y);p&&_&&(!this._repeatable&&o.everShownOnPage||this.setTriggered("document"===n?e.document.body:h[u]),a=!0)}a||this.setUntriggered()}}},g.Conditional=function(e){this._matchMode=e.matchMode,this._negate=e.not===!0,this._value=e.value},g.Conditional.create=function(e){switch(e.type){case"cookie":return new g.ConditionalCookie(e);case"element":return new g.ConditionalElement(e);case"triggerElement":return new g.ConditionalTriggerElement(e);default:g.Tester.log(19,null,[e.type],2)}},g.Conditional.prototype.isTrue=function(e){var t=this._evaluate(e);return t=this._negate?!t:t},g.Conditional.prototype._evaluate=function(e){return!0},g.ConditionalCookie=function(e){g.Conditional.call(this,e)},u.inherits(g.ConditionalCookie,g.Conditional),g.ConditionalCookie.prototype._evaluate=function(e){return null!==u.readCookie(this._value)},g.ConditionalElement=function(e){g.Conditional.call(this,e)},u.inherits(g.ConditionalElement,g.Conditional),g.ConditionalElement.prototype._evaluate=function(e){var i=this._matchMode,o=t.querySelector(this._value);return o&&1===i?0!==o.offsetWidth:null!==o},g.ConditionalTriggerElement=function(e){g.Conditional.call(this,e)},u.inherits(g.ConditionalTriggerElement,g.Conditional),g.ConditionalTriggerElement.prototype._evaluate=function(e){return!!e&&u.matchesSelector(e,this._value)},g.PositionedLayer=function(e,t,i,o){this._layer=e,this._anchor=t,this._iframeStyles=i,this._offsetsAbsStyles={},this._offsetsPercentages={},this._offsets={},this._offsetsNegated={},this._offsetStyles={},this._currentLayerAnchorEdges=null,this._goClickCapturers={};var n=o.position.offset||{},r={x:0,y:0};for(var s in r)if(r.hasOwnProperty(s)){var a=n[s]?"string"==typeof n[s]?n[s]:n[s].toString():"0",l=a.indexOf("%")!==-1,h=parseInt(a,10);this._offsets[s]=l?0:h,this._offsetsPercentages[s]=l?h:0,this._offsetsNegated[s]=h<0,this._offsetsAbsStyles[s]=Math.abs(h)+(l?"%;":"px;"),this._offsetStyles[s]=h+(l?"%;":"px;")}this._edges=o.position.edges,this._timeout=null,this._position()},g.PositionedLayer.prototype.isClickCapturer=function(e){var t=this._goClickCapturers;for(var i in t)if(t.hasOwnProperty(i)&&e===t[i])return!0;return!1},g.PositionedLayer.prototype.focusFirstClickCapturer=function(){for(var e in this._goClickCapturers)if(this._goClickCapturers.hasOwnProperty(e)){this._goClickCapturers[e].focus();break}},g.PositionedLayer.prototype.setMetrics=function(e,t){this._positionWithSize(e),this._doGoClickCapturers(t)},g.PositionedLayer.prototype._position=function(){this._layer.requestCurrentMetrics(),this._again()},g.PositionedLayer.prototype._positionWithSize=function(t){if(this._anchor){if(0===this._anchor.offsetWidth)return void this._layer.forceHide();var i="";switch(this._iframeStyles.width&&"100%"!=this._iframeStyles.width||(i+="width:"+t.x+"px;"),this._iframeStyles.height||(i+="height:"+t.y+"px;"),this._anchor){case e:case e.document:i+=this._positionToWindow(t);break;default:i+=this._edges?this._positionByEdges(t,this._edges,this._offsetStyles):this._positionAutomatically(t)}u.setStyleAttribute(this._layer.div,i)}},g.PositionedLayer.prototype._positionToWindow=function(t){var i=this._edges,o=function(e){return!!i&&u.arrayIndexOf(i,e)!==-1},n=u.getViewportSize(),r=this._anchor===e&&t.y<n.y,s="position:"+(r?"fixed":"absolute")+";";if(o("left")===o("right")){var a=this._offsets.x-Math.min(n.x/2,t.x/2);s+="right:auto;left:"+(this._offsetsPercentages.x+50)+"%;margin-left:"+a+"px;"}else o("left")?s+="right:auto;left:"+this._offsetStyles.x:o("right")&&(s+="left:auto;right:"+(this._offsetsNegated.x?"":"-")+this._offsetsAbsStyles.x);if(o("top")===o("bottom")){var l=this._offsets.y-Math.min(n.y/2,t.y/2);s+="bottom:auto;top:"+(this._offsetsPercentages.y+50)+"%;margin-top:"+l+"px;"}else o("top")?s+="bottom:auto;top:"+this._offsetStyles.y:o("bottom")&&(s+="top:auto;bottom:"+(this._offsetsNegated.y?"":"-")+this._offsetsAbsStyles.y);return this._layerSetAnchorEdges([]),s},g.PositionedLayer.prototype._again=function(){n(this._timeout);var e=this;this._timeout=o(function(){e._position()},1e3)},g.PositionedLayer.prototype._positionAutomatically=function(e){var t,i=u.findFixedPos(this._anchor),o={x:this._anchor.offsetWidth,y:this._anchor.offsetHeight},n=u.getViewportSize(),r={left:i.x,right:n.x-(i.x+o.x),bottom:n.y-(i.y+o.y),top:i.y};t=r.left>e.x||r.right>e.x?r.left>r.right?"left":"right":r.top>r.bottom?"top":"bottom";var s={top:"bottom",right:"left",bottom:"top",left:"right"},a=s[t],l=function(e){return e.length>0&&"-"==e[0]?e.substring(1):"-"+e},h=this._offsetStyles,d={x:"right"===t?h.x:"left"===t?l(h.x):0,y:"top"===t?h.y:"bottom"===t?l(h.y):0};return this._positionByEdges(e,{anchor:[t],layer:[a]},d)},g.PositionedLayer.prototype._positionByEdges=function(e,t,i){var o=function(e,t,i){var o=function(e){return!!t&&u.arrayIndexOf(t,e)!==-1},i=i||{x:e.clientWidth,y:e.clientHeight},n={x:i.x/2,y:i.y/2};return o("top")&&(n.y=0),o("bottom")&&(n.y=i.y),o("left")&&(n.x=0),o("right")&&(n.x=i.x),n},n=u.findFixedPos(this._anchor),r=o(this._anchor,t.anchor),s=o(this._layer.div,t.layer,e),a={x:n.x+r.x,y:n.y+r.y},l={x:a.x-s.x,y:a.y-s.y},h=u.getViewportSize(),d=function(e,t,i){return e<t?t:e>i?i:e};l.x=d(l.x,0,h.x-e.x),l.y=d(l.y,0,h.y-e.y);var c="position:fixed;left:"+l.x+"px;top:"+l.y+"px;margin-left:"+i.x+"margin-top:"+i.y;return this._layerSetAnchorEdges(t.layer),c},g.PositionedLayer.prototype._layerSetAnchorEdges=function(e){var t=null===this._currentLayerAnchorEdges||this._currentLayerAnchorEdges.length!==e.length;if(!t)for(var i=0;i<e.length;++i)if(u.arrayIndexOf(this._currentLayerAnchorEdges,e[i])==-1){t=!0;break}t&&(this._currentLayerAnchorEdges=e,this._layer.onAnchorEdgesChanged(e))},g.PositionedLayer.prototype._doGoClickCapturers=function(e){for(var i in e)if(e.hasOwnProperty(i)){var o=e[i],n=t.getElementById(i);if(!n){var r="";delete this._goClickCapturers[i],n=t.createElement("a"),n.id=i,n.href="javascript:void(0)",n.className=g.Main.GO_CLICK_CAPTURER_CLASS,o.title&&(n.title=o.title,r=" - "+o.title),o.text&&("undefined"!=typeof n.textContent?n.textContent=o.text+r:n.innerText=o.text+r),this._layer.div.insertBefore(n,this._layer.div.firstChild),this._goClickCapturers[i]=n}u.setStyleAttribute(n,"top:"+o.top+"px;left:"+o.left+"px;width:"+o.width+"px;height:"+o.height+"px;")}},g.PositionedLayer.prototype.destroy=function(){n(this._timeout),this._timeout=null,this._anchor=null,this._layer=null;for(var e in this._goClickCapturers)if(this._goClickCapturers.hasOwnProperty(e)){var i=t.getElementById(e);i&&i.parentNode&&i.parentNode.removeChild(i)}this._goClickCapturers={}},g._generateAndSetId=function(e){var t=u.genGuid();return g.setId(t,e),t},g.getId=function(e){var t=g._getId();return e="undefined"==typeof e?EDRSurvey.TRACKING_DAYS:e,null===t&&e!=g.TRACKING_DAYS_DISABLED&&(t=g._generateAndSetId(e)),t},g.setId=function(e,t){if("undefined"==typeof t||isNaN(t))throw"Days not defined";if(t<0)throw"Days smaller than 0";u.createCookie(g.TRACKING_COOKIE_NAME,e,t,g.Main.DOMAIN),g.EventHub.raise(g.EventHub.TRACKING_ID_SET,e)},g._getId=function(){return u.readCookie(g.TRACKING_COOKIE_NAME)},g.Tester={MAX_ITEMS_WHEN_NOT_IN_TEST_MODE:100,receivedStrings:!1,_testPanel:null,_logPanel:null,_messageStrings:{},_logItems:[],activate:function(e){if(e&&(this._messageStrings=e,this.receivedStrings=!0),!this._testPanel){var i=t.createElement("style");i.type="text/css",u.setStyleBlock(i,"#edr_test {font-size:12px;text-align:left;font-family:monospace;position:fixed;bottom:0;left:0;right:0;height:15%;z-index:"+g.Main.ZINDEX_ON_TOP+";background-color:#fff;border-top:1px solid silver;overflow:auto;color:black;}#edr_test ul, #edr_debug_panel li {padding:0;margin:0;list-style-type:none;}#edr_test li span {margin-right:1em;}#edr_test li span.id {font-weight:bold; min-width: 10em;display:inline-block;}#edr_test li.t_3 {color:red;}#edr_test li.t_4 {color:goldenrod;}#edr_test li.s_lcl {background-color:#E9E9FF;}#edr_test li.s_prv {background-color:#FFF7E6;}#edr_test li.s_svr {background-color:#F7E6FF;}#edr_test li.t_2 {color:white;background-color:red;}."+g.Main.GO_CLICK_CAPTURER_CLASS+" {opacity:0.5;display:block;filter: alpha(opacity = 50);background-color:white;outline:1px solid fuchsia;}");var o=t.getElementsByTagName("head")[0];o.appendChild(i);var n=this._testPanel=t.createElement("div");n.id="edr_test",g.Main._domContainer.appendChild(n),this._logPanel=t.createElement("ul"),
n.appendChild(this._logPanel)}this._refresh()},isActive:function(){return null!==this._testPanel},_refresh:function(){for(;this._logPanel.childNodes.length>=1;)this._logPanel.removeChild(this._logPanel.firstChild);for(var e=0;e<this._logItems.length;++e)this._logItem(this._logItems[e])},_logItem:function(e){var i,o=function(e){return null===e?"null":void 0===e?"undefined":e.nodeName?"Node: "+e.nodeName:e.toString()},n=t.createElement("li"),r={};switch(e.src){case 0:r.src="lcl";break;case 1:r.src="svr";break;case 2:r.src="prv"}if(n.className="t_"+e.type+" s_"+r.src,r.dt=e.dt.toLocaleTimeString(),e.id&&(r.id=e.id),e.msg)r.msg=e.msg;else{var s=e.p instanceof Array?e.p:[e.p],a=this._messageStrings[e.c];if(a){for(i=0;i<s.length;++i)a=a.replace("{"+i+"}",o(s[i]));r.msg=a}else for(r.code=e.c,i=0;i<s.length;++i)r["par_"+i]=o(s[i])}for(var l in r)if(r.hasOwnProperty(l)){var h=t.createElement("span");h.className=l,h.innerText=h.textContent=r[l],n.appendChild(h)}this._logPanel.insertBefore(n,this._logPanel.firstChild)},log:function(e,t,i,o){void 0===o&&(o=6),this._rawLogItem({dt:new Date,src:0,type:o,id:t,c:e,p:i})},providerLog:function(e,t,i){void 0===i&&(i=6),this._rawLogItem({dt:new Date,src:2,type:i,id:e,msg:t})},serverLog:function(e,t){this._rawLogItem({dt:new Date(1e3*t.dt),src:1,type:t.type,id:e,msg:t.msg})},_rawLogItem:function(e){this._logItems.push(e),this._logPanel?this._logItem(e):this._logItems.length>this.MAX_ITEMS_WHEN_NOT_IN_TEST_MODE&&this._logItems.pop()}},g.EventHub={BEFORE_INITIALISED:"beforeInitialised",INITIALISED:"initialised",LAYER_INITIALISED:"layerInitialised",LAYER_CAN_SHOW:"layerCanShow",LAYER_WONT_SHOW:"layerWontShow",LAYER_SHOWN:"layerShown",LAYER_HIDDEN:"layerHidden",LAYER_DESTROYED:"layerDestroyed",LAYER_EXECUTED:"layerExecuted",LAYER_INTERACTED:"layerInteracted",TRACKING_ID_SET:"trackingIdSet",_handlers:[],attach:function(e,t){if("function"!=typeof t)return!1;var i=this._find(e,t);return i===-1&&(this._handlers.push({e:e,h:t}),!0)},detach:function(e,t){var i=this._find(e,t);if(i===-1)return!1;var o=this._handlers.slice(i+1||this._handlers.length);return this._handlers.length=i<0?this._handlers.length+i:i,this._handlers.push.apply(this._handlers,o),!0},raise:function(e,t){for(var i=0;i<this._handlers.length;++i){var o=this._handlers[i];if(o.e===e)try{o.h.call(d,t||null)}catch(n){}}},_find:function(e,t){for(var i=0;i<this._handlers.length;++i){var o=this._handlers[i];if(o.e===e&&o.h===t)return i}return-1}},g.Main={REMOTE_HOST:null,REMOTE_PATH:null,ID:null,LOCALE:null,DATA1:null,DATA2:null,DATA3:null,TEST:!1,VERSION:null,PROPORTION:null,DOMAIN:"",ZINDEX_ON_TOP:999999,GO_CLICK_CAPTURER_CLASS:"edr_go",LAYER_IFRAME_CLASS:"edr_layer",COOKIE_FORCED_CONFIG_PREFIX:"eds_fcfg_",eDRUrlBase:null,layers:{},holdingWindowAccessDocument:e.location,pushedProbeValues:{},_domContainer:null,_cookiesEnabled:!1,_flashVersion:null,_platformSupported:null,_initialised:!1,_savedElementTabIndices:[],_layersWithLightboxes:[],main:function(){g.Tester.log(1);var e=t.domain;this.DOMAIN?e.indexOf(this.DOMAIN,e.length-this.DOMAIN.length)===-1&&(g.Tester.log(29,null,this.DOMAIN,3),this.DOMAIN=e):this.DOMAIN=e,g.Tester.log(28,null,this.DOMAIN),this._tick();var i=this;r(function(){i._tick()},500),this._waitForReady(1)},_waitForReady:function(e){g.Tester.log(2,null,e);var i=this;/in/.test(t.readyState)?o(function(){i._waitForReady(e+1)},9):this._checkBeforeInitialised(1)},_checkBeforeInitialised:function(e){var t={wait:!1,abort:!1};if(g.EventHub.raise(g.EventHub.BEFORE_INITIALISED,t),!t.abort)if(t.wait){var i=this;g.Tester.log(30,null,e),o(function(){i._checkBeforeInitialised(e+1)},100+500*(e-1))}else this._start()},_start:function(){g.Tester.log(3);var i=e.ecos_sid,o=e.ecos_vault;i&&o&&g.Tester.log(32,null,"ESV-"+("_"!==o?o+"-":"")+i,4),g.PageState.init(),this._cookiesEnabled=u.areCookiesEnabled(),this._flashVersion=u.getFlashVersion(),this._platformSupported=this._testIfPlatformSupported(this._cookiesEnabled,this._flashVersion),g.Tester.log(4,null,[this._cookiesEnabled,this._flashVersion,this._platformSupported],this._platformSupported?6:2),this.eDRUrlBase=("https:"===t.location.protocol?"https://":"http://")+this.REMOTE_HOST+this.REMOTE_PATH;var n=t.getElementsByTagName("head")[0],r=t.createElement("style");r.type="text/css",n.appendChild(r),u.setStyleBlock(r,"#edr_survey .edr_lwrap iframe {width:100%;height:100%;}#edr_survey ."+this.GO_CLICK_CAPTURER_CLASS+" {opacity:0;display:block;filter:alpha(opacity = 0);position:absolute;font-size:0;background-color:#000;margin:0;padding:0;z-index:"+(this.ZINDEX_ON_TOP+1)+";}#edr_survey .edr_lb {position:fixed;top:0;left:0;right:0;bottom:0;z-index:"+(this.ZINDEX_ON_TOP-1)+";display:none;}");var s=this._domContainer=t.createElement("div");s.id="edr_survey",t.body.insertBefore(s,t.body.firstChild),this.TEST&&g.Tester.activate(),this._attachDocumentEvents(t),g.EventHub.raise(g.EventHub.INITIALISED,{supportedPlatform:this._platformSupported}),this._initialised=!0,Math.random()<this.PROPORTION?this.deployDeployment():g.Tester.log(44,this.logId,[this.PROPORTION])},_tick:function(){u.createCookie("ecos.dt",+new Date,null,this.DOMAIN)},_attachDocumentEvents:function(e){var t=this;u.addEvents(e,["click","mouseover","mouseout","keyup"],function(e){for(var i in t.layers)t.layers.hasOwnProperty(i)&&t.layers[i].onEvent(e)}),u.addEvents(e,["focus","blur"],function(e){for(var i in t.layers)t.layers.hasOwnProperty(i)&&t.layers[i].onEvent(e)},!0)},onLayerInitialised:function(e,t){this.layers[e]=t},onLayerDestroyed:function(e){delete this.layers[e]},deployLayer:function(e){g.Tester.log(36,this.logId);var t="l:"+e,i=this.layers[t];return i||(i=new g.Layer(t)),i},deployDeployment:function(e,t,i){var o=this.layers[e];if(!o){var n=u.readCookie(g.Main.COOKIE_FORCED_CONFIG_PREFIX+e);e&&!t&&n&&"1"!==n.rdi&&(t=n.rdi),e&&!i&&n&&""!==n.rl&&(i=n.rl),o=new g.Layer(e,t,i)}return o},redeploy:function(){if(!this._initialised)return null;var e=this.layers[null];return e&&e.destroy(),Math.random()<this.PROPORTION?this.deployDeployment():(g.Tester.log(44,this.logId,[this.PROPORTION]),null)},getLayerByName:function(e){for(var t in this.layers)if(this.layers.hasOwnProperty(t)&&this.layers[t].name===e)return this.layers[t];return null},getLayerByDeploymentId:function(e){for(var t in this.layers)if(this.layers.hasOwnProperty(t)&&this.layers[t].getDeploymentId()==e)return this.layers[t];return null},getLayerById:function(e){return this.layers[e]?this.layers[e]:null},buildUrl:function(i,o){var n=this.eDRUrlBase+i+".php?id="+this.ID;this._platformSupported||(n+="&s=0"),g.Tester.isActive()&&(n=n+"&t="+(g.Tester.receivedStrings?2:1)),n+="&v="+this.VERSION;for(var r="",s=e.location.href,a=0,d=0;d<s.length;d++)"/"===s.charAt(d)&&a++,a>=3&&(r+=s.charAt(d));this.LOCALE.length>0&&(n+="&l="+l(this.LOCALE)),this.DATA1.length>0&&(n+="&d1="+l(this.DATA1)),this.DATA2.length>0&&(n+="&d2="+l(this.DATA2)),this.DATA3.length>0&&(n+="&d3="+l(this.DATA3)),screen.width>0&&screen.height>0&&(n+="&x="+screen.width+"&y="+screen.height),screen.colorDepth>0&&(n+="&d="+screen.colorDepth),this._cookiesEnabled&&(n+="&c="+l(u.readCookie(EDRSurvey.COOKIE_NAME,"."))),n+="&ck="+(this._cookiesEnabled?"1":"0"),null!==this._flashVersion&&(n+="&fl="+l(this._flashVersion)),this.PROPORTION<1&&(n+="&pr="+this.PROPORTION),n+="&p="+l(r.substring(0,100)),t.referrer&&(n+="&ref="+l(t.referrer.substring(0,100))),h.indexOf("Safari")>=0&&(n+="&fu="+l(e.location.href));var c=g.Main.COOKIE_FORCED_CONFIG_PREFIX,y=u.readCookiesWithPrefix(c),p=[],_=[];for(var f in y)if(y.hasOwnProperty(f))try{_.push(JSON.parse(y[f])),p.push(f.substr(c.length))}catch(m){}0<p.length&&(n+="&fd="+l(p.join())),0<_.length&&"1"!==_[0].rdi&&(n+="&rdi="+l(_[0].rdi)),0<_.length&&""!==_[0].rl&&!o.rlang&&(n+="&rlang="+l(_[0].rl));for(var v in o)o.hasOwnProperty(v)&&(n+="&"+v+"="+l(o[v]));return n},_testIfPlatformSupported:function(i,o){if(!i)return!1;var n=function(e){return"undefined"!=typeof e&&null!==e},r=n(t.querySelector)&&n(t.querySelectorAll);if(!r)return!1;if(!("classList"in t.createElement("_")))return!1;var s=n(e.postMessage);return!!s&&n(e.eDRXDMClient)},getLayers:function(){var e=[];for(var t in this.layers)this.layers.hasOwnProperty(t)&&e.push(this.layers[t]);return e},getTester:function(){return g.Tester},setProbeValues:function(e){for(var t in e)e.hasOwnProperty(t)&&this.setProbeValue(t,e[t])},setProbeValue:function(e,t){if(!t.substring&&!t.toFixed&&t!==!0&&t!==!1)throw"Invalid probe value for key: "+e;this.pushedProbeValues[e]=t.substring?t.toString():t},getProbeValue:function(e){return this.pushedProbeValues[e]},getProbeValues:function(){return this.pushedProbeValues},setDomainAccessDocumentPath:function(e){if(!e.substring)throw"Path must be a string";this.holdingWindowAccessDocument=e},flagLightboxDisplayed:function(e){u.arrayIndexOf(this._layersWithLightboxes,e)===-1&&this._layersWithLightboxes.push(e),this._layersWithLightboxes.length&&this._constrainFocus()},flagLightboxHidden:function(e){var t=u.arrayIndexOf(this._layersWithLightboxes,e);t!==-1&&this._layersWithLightboxes.splice(t,1),this._layersWithLightboxes.length||this._unconstrainFocus()},_constrainFocus:function(){for(var e=t.querySelectorAll("a, button, input, select, [tabindex], iframe"),i=0;i<e.length;++i){var o=e[i].className?e[i].className.split(" "):[];e[i].getAttribute&&e[i].setAttribute&&u.arrayIndexOf(o,g.Main.GO_CLICK_CAPTURER_CLASS)===-1&&u.arrayIndexOf(o,g.Main.LAYER_IFRAME_CLASS)===-1&&(this._savedElementTabIndices.push({e:e[i],ti:e[i].getAttribute("tabindex")}),e[i].setAttribute("tabindex",-1))}},_unconstrainFocus:function(){for(var e=0;e<this._savedElementTabIndices.length;++e){var t=this._savedElementTabIndices[e];null!==t.ti?t.e.setAttribute("tabindex",t.ti):t.e.removeAttribute("tabindex")}this._savedElementTabIndices=[]}},g.EventHub.attach(g.EventHub.LAYER_SHOWN,function(e){null===g._getId()&&g.TRACKING_DAYS_DISABLED!==EDRSurvey.TRACKING_DAYS&&g._generateAndSetId(EDRSurvey.TRACKING_DAYS)}),d.EDRSurvey=g.Main,g.Main.main=g.Main.main,g.Main.setProbeValue=g.Main.setProbeValue,g.Main.setProbeValues=g.Main.setProbeValues,g.Main.getProbeValue=g.Main.getProbeValue,g.Main.getProbeValues=g.Main.getProbeValues,g.Main.setDomainAccessDocumentPath=g.Main.setDomainAccessDocumentPath,g.Main.deployLayer=g.Main.deployLayer,g.Main.getLayers=g.Main.getLayers,g.Main.getTester=g.Main.getTester,g.Main.redeploy=g.Main.redeploy,g.Main.Events=g.EventHub,g.Main.Events.attach=g.EventHub.attach,g.Main.Events.detach=g.EventHub.detach,g.Layer.prototype.getDeploymentId=g.Layer.prototype.getDeploymentId,g.Layer.prototype.getName=g.Layer.prototype.getName,g.Layer.prototype.hide=g.Layer.prototype.hide,g.Layer.prototype.trigger=g.Layer.prototype.trigger,g.Layer.prototype.destroy=g.Layer.prototype.destroy,g.Layer.prototype.showLightbox=g.Layer.prototype.showLightbox,g.Layer.prototype.hideLightbox=g.Layer.prototype.hideLightbox,g.Layer.prototype.getDeployment=g.Layer.prototype.getDeployment,g.Deployment.prototype.getSurveyId=g.Deployment.prototype.getSurveyId,g.Deployment.prototype.getInstallationId=g.Deployment.prototype.getInstallationId,g.Deployment.prototype.getLayerId=g.Deployment.prototype.getLayerId,g.Deployment.prototype.getDeploymentId=g.Deployment.prototype.getDeploymentId,g.Deployment.prototype.getDeployId=g.Deployment.prototype.getDeployId,g.Deployment.prototype.getTriggerId=g.Deployment.prototype.getTriggerId,g.Deployment.prototype.getType=g.Deployment.prototype.getType,g.Main.getId=g.getId,EDRSurvey.REMOTE_HOST="edigitalsurvey.com",EDRSurvey.REMOTE_PATH="/",EDRSurvey.COOKIE_NAME="ckps_eds",EDRSurvey.ID="INS-642345567",EDRSurvey.LOCALE="",EDRSurvey.DATA1="",EDRSurvey.DATA2="",EDRSurvey.DATA3="",EDRSurvey.TEST=!1,EDRSurvey.VERSION="7281",EDRSurvey.PROPORTION=.25,EDRSurvey.DOMAIN="",EDRSurvey.TRACKING_DAYS=-1,EDRSurvey.main()}(window,document,location,window.setTimeout,window.clearTimeout,window.setInterval,window.clearInterval,decodeURIComponent,encodeURIComponent,navigator.userAgent),require(["istats-1"],function(e){EDRSurvey.bbc={hasTaken:null},EDRSurvey.Events.attach("layerShown",function(t){EDRSurvey.bbc.hasTaken=!1;var i=document.cookie.match(/s1=([^;]+)/),o=e.labelsSent(),n="";if(i[1]){n=i[1],labelsNames=[];for(var r in o)o.hasOwnProperty(r)&&o[r].name&&-1===labelsNames.indexOf(o[r].name)&&labelsNames.push(o[r].name);if(0<labelsNames.length){var s=labelsNames.join(":");0<s.length&&250>n.length+s.length&&(n+="|name="+s)}}EDRSurvey.DATA3=n}),EDRSurvey.Events.attach("layerExecuted",function(t){EDRSurvey.bbc.hasTaken=!0,e&&e.log&&e.log("click","oqs-survey-yes")}),EDRSurvey.Events.attach("layerDestroyed",function(t){EDRSurvey&&EDRSurvey.bbc&&EDRSurvey.bbc.hasTaken===!1&&e&&e.log&&e.log("click","oqs-survey-no")})});