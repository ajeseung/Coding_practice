(function(){var outbrain_elements;var pmc_ob_event_tracking=function(element){this.obElement=element;this.device=this.getDevice();this.obElementDynamicLinkContainer=".ob-dynamic-rec-container";this.obElementDynamicLink=".ob-dynamic-rec-link";this.obWidgetId=element.getAttribute("data-widget-id");this.linksData=[];this.initMutationObserver()};pmc_ob_event_tracking.prototype.initMutationObserver=function(){var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(undefined===MutationObserver||null===MutationObserver){return}this.observer=new MutationObserver(this.mutationObserverCallback.bind(this));this.observer.observe(this.obElement,{childList:true})};pmc_ob_event_tracking.prototype.mutationObserverCallback=function(mutationsList,observer){var dynamicLinks=this.obElement.querySelectorAll(this.obElementDynamicLinkContainer);if(dynamicLinks&&0<dynamicLinks.length){observer.disconnect();this.getObDynamicLinks(dynamicLinks)}};pmc_ob_event_tracking.prototype.getObDynamicLinks=function(elements){var object={},link,el,index,pos;for(index=0;index<elements.length;index++){el=elements[index];pos=index+1;el.setAttribute("data-index",pos);link=el.querySelector(this.obElementDynamicLink);link=link?link.getAttribute("href"):"";object[pos]=this.cleanURL(link)}this.linksData=object;this.sendGaEvent(JSON.stringify(this.linksData),true);this.addObClickEventListener()};pmc_ob_event_tracking.prototype.addObClickEventListener=function(){this.obElement.addEventListener("click",this.obClickEventCallback.bind(this))};pmc_ob_event_tracking.prototype.obClickEventCallback=function(event){var el=event.srcElement||event.target,allowedTarget="_blank",linkContainerClassName,pos,elLink,elTarget,link,label,object;while(el&&(undefined===el.tagName||"a"!==el.tagName.toLowerCase()||!el.href)){el=el.parentNode}elLink=el.href;elTarget=el.target;elTarget=allowedTarget===elTarget?allowedTarget:false;if(this.isEmpty(elLink)){return}el=el.parentNode;linkContainerClassName=this.obElementDynamicLinkContainer.substring(1);if(el&&-1===el.className.indexOf(linkContainerClassName)){return}if(event.ctrlKey||event.shiftKey||event.metaKey||2===event.which){elTarget=allowedTarget}pos=el.getAttribute("data-index");link=this.linksData[pos];if(this.isEmpty(link)){return}object={};object[pos]=link;label=JSON.stringify(object);if(allowedTarget===elTarget){this.sendGaEvent(label)}else{event.preventDefault();this.sendGaEvent(label,false,this.createFunctionWithTimeout(function(){window.location.href=elLink}))}};pmc_ob_event_tracking.prototype.isEmpty=function(value){return null==value||0===value.length};pmc_ob_event_tracking.prototype.createFunctionWithTimeout=function(callback,opt_timeout){var called=false;function fn(){if(!called){called=true;callback()}}setTimeout(fn,opt_timeout||1e3);return fn};pmc_ob_event_tracking.prototype.sendGaEvent=function(eventLabel,load,hitCallback){var isInteracting=undefined!==load?load:false,label=this.device+" ["+this.obWidgetId+"] "+eventLabel;var analyticsObject={};analyticsObject.hitType="event";analyticsObject.eventCategory="outbrain";analyticsObject.eventAction=load?"load":"click";analyticsObject.eventLabel=label;analyticsObject.nonInteraction=isInteracting;analyticsObject.transport="beacon";let ga4EventObject={};ga4EventObject.eventCategory="outbrain";ga4EventObject.eventAction=load?"load":"click";ga4EventObject.eventLabel=String(label).substring(0,99);let ga4EventName=String(ga4EventObject.eventCategory+"-"+ga4EventObject.eventAction).substring(0,39);if(undefined!==hitCallback&&"function"===typeof hitCallback){analyticsObject.hitCallback=hitCallback}try{ga("send",analyticsObject);gtag("event",ga4EventName,ga4EventObject)}catch(e){}};pmc_ob_event_tracking.prototype.cleanURL=function(url){if(-1!==url.indexOf("traffic.outbrain.com")||-1!==url.indexOf("paid.outbrain.com")){return url}return url.split(/[?#]/)[0]};pmc_ob_event_tracking.prototype.getDevice=function(){var defaultDevice="[D]",deviceObject=window.pmc_ga_event_tracking,device=deviceObject?deviceObject.device?deviceObject.device:defaultDevice:defaultDevice;return device};outbrain_elements=document.querySelectorAll(".OUTBRAIN");if(0<outbrain_elements.length){for(var i=0;i<outbrain_elements.length;i++){new pmc_ob_event_tracking(outbrain_elements[i])}}})();
